{"ast":null,"code":"function ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n/* eslint-disable require-jsdoc, no-console */\n\nimport areachart from \"src/decidim/vizzs/areachart\";\n$(function () {\n  var metricsData = {};\n  var metricsContainer = {};\n  var metricsParams = {};\n  var query = function query() {\n    var metricsQuery = \"metrics(names: \".concat(metricsParams.names, \", space_type: \\\"\").concat(metricsParams.spaceType, \"\\\", space_id: \").concat(metricsParams.spaceId, \") { name history { key value } }\");\n    return {\n      query: \"{ \".concat(metricsQuery, \" }\")\n    };\n  };\n  var parameterize = function parameterize(metrics) {\n    metricsParams.names = JSON.stringify(metrics || []);\n    metricsParams.spaceType = $(\"#metrics #metrics-space_type\").val() || null;\n    metricsParams.spaceId = $(\"#metrics #metrics-space_id\").val() || null;\n  };\n  var fetch = function fetch(metrics) {\n    return $.post(\"/api\", query(metrics));\n  };\n  var downloadMetricData = function downloadMetricData(event) {\n    event.preventDefault();\n    var metricName = $(event.target).parents(\".metric-downloader\").data(\"metric\");\n    var csvContent = \"data:text/csv;charset=utf-8,\";\n    csvContent += \"key,value\\r\\n\";\n    metricsData[metricName].forEach(function (metricData) {\n      csvContent += \"\".concat(metricData.key, \",\").concat(metricData.value, \"\\r\\n\");\n    });\n\n    // Required for FF\n    var link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodeURI(csvContent));\n    link.setAttribute(\"download\", \"\".concat(metricName, \"_metric_data.csv\"));\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n  $(\".metric-chart:visible\").each(function (_index, container) {\n    metricsContainer[$(container).data(\"metric\")] = container;\n  });\n  $(\".metric-downloader\").each(function (_index, container) {\n    container.onclick = downloadMetricData;\n  });\n  if (!$.isEmptyObject(metricsContainer)) {\n    parameterize(Object.keys(metricsContainer));\n    fetch().then(function (response) {\n      if (response.data) {\n        $.each(response.data.metrics, function (_index, metricData) {\n          var container = metricsContainer[metricData.name];\n          if (metricData.history.length === 0) {\n            $(container).remove();\n            return;\n          }\n          var info = $(container).data(\"info\");\n          metricsData[metricData.name] = $.extend(true, [], metricData.history);\n          areachart(_objectSpread({\n            container: \"#\".concat(container.id),\n            data: metricData.history,\n            title: info.title,\n            objectName: info.object\n          }, $(container).data()));\n        });\n      } else if (response.errors) {\n        console.log(\"Something wrong happened when fetching metrics:\");\n        $.each(response.errors, function (_index, error) {\n          console.log(error.message);\n        });\n        $(\"#metrics\").remove();\n      }\n    }).fail(function (err) {\n      console.log(\"Something wrong happened when fetching metrics: \".concat(err.statusText));\n      $(\"#metrics\").remove();\n    });\n  }\n});","map":{"version":3,"mappings":"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","names":["areachart","$","metricsData","metricsContainer","metricsParams","query","metricsQuery","names","spaceType","spaceId","parameterize","metrics","JSON","stringify","val","fetch","post","downloadMetricData","event","preventDefault","metricName","target","parents","data","csvContent","forEach","metricData","key","value","link","document","createElement","setAttribute","encodeURI","body","appendChild","click","removeChild","each","_index","container","onclick","isEmptyObject","Object","keys","then","response","name","history","length","remove","info","extend","id","title","objectName","object","errors","console","log","error","message","fail","err","statusText"],"sources":["/home/alan/.rvm/gems/ruby-3.0.3/gems/decidim-core-0.27.0/app/packs/src/decidim/vizzs/index.js"],"sourcesContent":["/* eslint-disable require-jsdoc, no-console */\n\nimport areachart from \"src/decidim/vizzs/areachart\"\n\n$(() => {\n\n  const metricsData = {};\n  const metricsContainer = {};\n  const metricsParams = {};\n\n  const query = () => {\n    let metricsQuery = `metrics(names: ${metricsParams.names}, space_type: \"${metricsParams.spaceType}\", space_id: ${metricsParams.spaceId}) { name history { key value } }`;\n    return {query: `{ ${metricsQuery} }`};\n  }\n\n  const parameterize = (metrics) => {\n    metricsParams.names = JSON.stringify(metrics || []);\n    metricsParams.spaceType = $(\"#metrics #metrics-space_type\").val() || null;\n    metricsParams.spaceId = $(\"#metrics #metrics-space_id\").val() || null;\n  }\n\n  const fetch = (metrics) => $.post(\"/api\", query(metrics));\n\n  const downloadMetricData = (event) => {\n    event.preventDefault();\n    let metricName = $(event.target).parents(\".metric-downloader\").data(\"metric\");\n    let csvContent = \"data:text/csv;charset=utf-8,\";\n\n    csvContent += \"key,value\\r\\n\";\n    metricsData[metricName].forEach((metricData)  => {\n      csvContent += `${metricData.key},${metricData.value}\\r\\n`;\n    });\n\n    // Required for FF\n    let link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodeURI(csvContent));\n    link.setAttribute(\"download\", `${metricName}_metric_data.csv`);\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  $(\".metric-chart:visible\").each((_index, container) => {\n    metricsContainer[$(container).data(\"metric\")] = container;\n  });\n  $(\".metric-downloader\").each((_index, container) => {\n    container.onclick = downloadMetricData;\n  });\n\n  if (!$.isEmptyObject(metricsContainer)) {\n    parameterize(Object.keys(metricsContainer))\n    fetch().then((response) => {\n      if (response.data) {\n        $.each(response.data.metrics, (_index, metricData) => {\n          let container = metricsContainer[metricData.name];\n          if (metricData.history.length === 0) {\n            $(container).remove();\n            return;\n          }\n          let info = $(container).data(\"info\");\n          metricsData[metricData.name] = $.extend(true, [], metricData.history);\n          areachart({\n            container: `#${container.id}`,\n            data: metricData.history,\n            title: info.title,\n            objectName: info.object,\n            ...$(container).data()\n          });\n        });\n      } else if (response.errors) {\n        console.log(\"Something wrong happened when fetching metrics:\");\n        $.each(response.errors, (_index, error) => {\n          console.log(error.message);\n        });\n        $(\"#metrics\").remove();\n      }\n    }).fail((err) => {\n      console.log(`Something wrong happened when fetching metrics: ${err.statusText}`);\n      $(\"#metrics\").remove();\n    });\n  }\n});\n"]},"metadata":{},"sourceType":"module"}