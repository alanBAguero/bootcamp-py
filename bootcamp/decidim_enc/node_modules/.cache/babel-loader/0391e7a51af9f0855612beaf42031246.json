{"ast":null,"code":"var currentAllocationZero = function currentAllocationZero() {\n  var $budgetSummary = $(\".budget-summary__progressbox\");\n  return parseInt($budgetSummary.attr(\"data-current-allocation\"), 10) === 0;\n};\nvar isSafeUrl = function isSafeUrl(exitUrl) {\n  if (!exitUrl) {\n    return false;\n  }\n  var safeUrls = [$(\".budget-summary\").attr(\"data-safe-url\").split(\"?\")[0], \"\".concat(location.pathname, \"#\"), \"\".concat(location.href, \"#\"), \"#\"];\n  var safe = false;\n  safeUrls.forEach(function (url) {\n    if (exitUrl.startsWith(url)) {\n      safe = true;\n    }\n  });\n  return safe;\n};\nvar allowExitFrom = function allowExitFrom($el) {\n  if (currentAllocationZero()) {\n    return true;\n  } else if ($el.attr(\"target\") === \"_blank\") {\n    return true;\n  } else if ($el.parents(\"#loginModal\").length > 0) {\n    return true;\n  } else if ($el.parents(\"#authorizationModal\").length > 0) {\n    return true;\n  } else if ($el.attr(\"id\") === \"exit-notification-link\") {\n    return true;\n  } else if ($el.parents(\".voting-wrapper\").length > 0) {\n    return true;\n  } else if (isSafeUrl($el.attr(\"href\"))) {\n    return true;\n  }\n  return false;\n};\n$(function () {\n  var $exitNotification = $(\"#exit-notification\");\n  var $exitLink = $(\"#exit-notification-link\");\n  var defaultExitUrl = $exitLink.attr(\"href\");\n  var defaultExitLinkText = $exitLink.text();\n  var exitLinkText = defaultExitLinkText;\n  if ($exitNotification.length < 1) {\n    // Do not apply when not inside the voting pipeline\n    return;\n  }\n  var openExitNotification = function openExitNotification(url) {\n    var method = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    if (method && method !== \"get\") {\n      $exitLink.attr(\"data-method\", method);\n    } else {\n      $exitLink.removeAttr(\"data-method\");\n    }\n    $exitLink.attr(\"href\", url);\n    $exitLink.html(exitLinkText);\n    $exitNotification.foundation(\"open\");\n  };\n  $(document).on(\"click\", \"a\", function (event) {\n    exitLinkText = defaultExitLinkText;\n    var $link = $(event.currentTarget);\n    if (!allowExitFrom($link)) {\n      event.preventDefault();\n      openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n    }\n  });\n  // Custom handling for the header sign out so that it won't trigger the\n  // logout form submit and so that it changes the exit link text. This does\n  // not trigger the document link click listener because it has the\n  // data-method attribute to trigger a form submit event.\n  $(\".header a.sign-out-link\").on(\"click\", function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    var $link = $(event.currentTarget);\n    exitLinkText = $link.text();\n    openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n  });\n  // Custom handling for the exit link which needs to change the exit link\n  // text to the default text as this is not handled by the document click\n  // listener.\n  $(\"a[data-open='exit-notification']\").on(\"click\", function () {\n    exitLinkText = defaultExitLinkText;\n    openExitNotification(defaultExitUrl);\n  });\n});","map":{"version":3,"mappings":"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","names":["currentAllocationZero","$budgetSummary","$","parseInt","attr","isSafeUrl","exitUrl","safeUrls","split","location","pathname","href","safe","forEach","url","startsWith","allowExitFrom","$el","parents","length","$exitNotification","$exitLink","defaultExitUrl","defaultExitLinkText","text","exitLinkText","openExitNotification","method","removeAttr","html","foundation","document","on","event","$link","currentTarget","preventDefault","data","stopPropagation"],"sources":["/home/alan/.rvm/gems/ruby-3.0.3/gems/decidim-budgets-0.27.0/app/packs/src/decidim/budgets/exit_handler.js"],"sourcesContent":["const currentAllocationZero = () => {\n  const $budgetSummary = $(\".budget-summary__progressbox\");\n  return parseInt($budgetSummary.attr(\"data-current-allocation\"), 10) === 0;\n}\n\nconst isSafeUrl = (exitUrl) => {\n  if (!exitUrl) {\n    return false\n  }\n\n  const safeUrls = [\n    $(\".budget-summary\").attr(\"data-safe-url\").split(\"?\")[0],\n    `${location.pathname}#`,\n    `${location.href}#`,\n    \"#\"\n  ];\n\n  let safe = false;\n  safeUrls.forEach((url) => {\n    if (exitUrl.startsWith(url)) {\n      safe =  true\n    }\n  });\n\n  return safe;\n}\n\nconst allowExitFrom = ($el) => {\n  if (currentAllocationZero()) {\n    return true\n  } else if ($el.attr(\"target\") === \"_blank\") {\n    return true;\n  } else if ($el.parents(\"#loginModal\").length > 0) {\n    return true;\n  } else if ($el.parents(\"#authorizationModal\").length > 0) {\n    return true;\n  } else if ($el.attr(\"id\") === \"exit-notification-link\") {\n    return true;\n  } else if ($el.parents(\".voting-wrapper\").length > 0) {\n    return true;\n  } else if (isSafeUrl($el.attr(\"href\"))) {\n    return true\n  }\n\n  return false;\n}\n\n$(() => {\n  const $exitNotification = $(\"#exit-notification\");\n  const $exitLink = $(\"#exit-notification-link\");\n  const defaultExitUrl = $exitLink.attr(\"href\");\n  const defaultExitLinkText = $exitLink.text();\n  let exitLinkText = defaultExitLinkText;\n\n  if ($exitNotification.length < 1) {\n    // Do not apply when not inside the voting pipeline\n    return;\n  }\n\n  const openExitNotification = (url, method = null) => {\n    if (method && method !== \"get\") {\n      $exitLink.attr(\"data-method\", method);\n    } else {\n      $exitLink.removeAttr(\"data-method\");\n    }\n\n    $exitLink.attr(\"href\", url);\n    $exitLink.html(exitLinkText);\n    $exitNotification.foundation(\"open\");\n  };\n\n  $(document).on(\"click\", \"a\", (event) => {\n    exitLinkText = defaultExitLinkText;\n\n    const $link = $(event.currentTarget);\n    if (!allowExitFrom($link)) {\n      event.preventDefault();\n      openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n    }\n  });\n  // Custom handling for the header sign out so that it won't trigger the\n  // logout form submit and so that it changes the exit link text. This does\n  // not trigger the document link click listener because it has the\n  // data-method attribute to trigger a form submit event.\n  $(\".header a.sign-out-link\").on(\"click\", (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const $link = $(event.currentTarget);\n    exitLinkText = $link.text();\n    openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n  });\n  // Custom handling for the exit link which needs to change the exit link\n  // text to the default text as this is not handled by the document click\n  // listener.\n  $(\"a[data-open='exit-notification']\").on(\"click\", () => {\n    exitLinkText = defaultExitLinkText;\n    openExitNotification(defaultExitUrl);\n  });\n});\n"]},"metadata":{},"sourceType":"module"}