{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n/* eslint-disable require-jsdoc */\nvar DynamicFieldsComponent = /*#__PURE__*/function () {\n  function DynamicFieldsComponent() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, DynamicFieldsComponent);\n    this.wrapperSelector = options.wrapperSelector;\n    this.containerSelector = options.containerSelector;\n    this.fieldSelector = options.fieldSelector;\n    this.addFieldButtonSelector = options.addFieldButtonSelector;\n    this.addSeparatorButtonSelector = options.addSeparatorButtonSelector;\n    this.addTitleAndDescriptionButtonSelector = options.addTitleAndDescriptionButtonSelector;\n    this.fieldTemplateSelector = options.fieldTemplateSelector;\n    this.separatorTemplateSelector = options.separatorTemplateSelector;\n    this.TitleAndDescriptionTemplateSelector = options.TitleAndDescriptionTemplateSelector;\n    this.removeFieldButtonSelector = options.removeFieldButtonSelector;\n    this.moveUpFieldButtonSelector = options.moveUpFieldButtonSelector;\n    this.moveDownFieldButtonSelector = options.moveDownFieldButtonSelector;\n    this.onAddField = options.onAddField;\n    this.onRemoveField = options.onRemoveField;\n    this.onMoveUpField = options.onMoveUpField;\n    this.onMoveDownField = options.onMoveDownField;\n    this.placeholderId = options.placeholderId;\n    this.elementCounter = 0;\n    this._enableInterpolation();\n    this._activateFields();\n    this._bindEvents();\n  }\n  _createClass(DynamicFieldsComponent, [{\n    key: \"_enableInterpolation\",\n    value: function _enableInterpolation() {\n      $.fn.replaceAttribute = function (attribute, placeholder, value) {\n        $(this).find(\"[\".concat(attribute, \"*=\").concat(placeholder, \"]\")).addBack(\"[\".concat(attribute, \"*=\").concat(placeholder, \"]\")).each(function (index, element) {\n          $(element).attr(attribute, $(element).attr(attribute).replace(placeholder, value));\n        });\n        return this;\n      };\n      $.fn.template = function (placeholder, value) {\n        // See the comment below in the `_addField()` method regarding the\n        // `<template>` tag support in IE11.\n        var $subtemplate = $(this).find(\"template, .decidim-template\");\n        if ($subtemplate.length > 0) {\n          $subtemplate.html(function (index, oldHtml) {\n            return $(oldHtml).template(placeholder, value)[0].outerHTML;\n          });\n        }\n\n        // Handle those subtemplates that are mapped with the `data-template`\n        // attribute. This is also because of the IE11 support.\n        var $subtemplateParents = $(this).find(\"[data-template]\");\n        if ($subtemplateParents.length > 0) {\n          $subtemplateParents.each(function (_i, elem) {\n            var $self = $(elem);\n            var $tpl = $($self.data(\"template\"));\n\n            // Duplicate the sub-template with a unique ID as there may be\n            // multiple parent templates referring to the same sub-template.\n            var $subtpl = $($tpl[0].outerHTML);\n            var subtemplateId = \"\".concat($tpl.attr(\"id\"), \"-\").concat(value);\n            var subtemplateSelector = \"#\".concat(subtemplateId);\n            $subtpl.attr(\"id\", subtemplateId);\n            $self.attr(\"data-template\", subtemplateSelector).data(\"template\", subtemplateSelector);\n            $tpl.after($subtpl);\n            $subtpl.html(function (index, oldHtml) {\n              return $(oldHtml).template(placeholder, value)[0].outerHTML;\n            });\n          });\n        }\n        $(this).replaceAttribute(\"id\", placeholder, value);\n        $(this).replaceAttribute(\"name\", placeholder, value);\n        $(this).replaceAttribute(\"data-tabs-content\", placeholder, value);\n        $(this).replaceAttribute(\"for\", placeholder, value);\n        $(this).replaceAttribute(\"tabs_id\", placeholder, value);\n        $(this).replaceAttribute(\"href\", placeholder, value);\n        $(this).replaceAttribute(\"value\", placeholder, value);\n        return this;\n      };\n    }\n  }, {\n    key: \"_bindEvents\",\n    value: function _bindEvents() {\n      var _this = this;\n      $(this.wrapperSelector).on(\"click\", this.addFieldButtonSelector, function (event) {\n        return _this._bindSafeEvent(event, function () {\n          return _this._addField(_this.fieldTemplateSelector);\n        });\n      });\n      if (this.addSeparatorButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.addSeparatorButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function () {\n            return _this._addField(_this.separatorTemplateSelector);\n          });\n        });\n      }\n      if (this.addTitleAndDescriptionButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.addTitleAndDescriptionButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function () {\n            return _this._addField(_this.TitleAndDescriptionTemplateSelector);\n          });\n        });\n      }\n      $(this.wrapperSelector).on(\"click\", this.removeFieldButtonSelector, function (event) {\n        return _this._bindSafeEvent(event, function (target) {\n          return _this._removeField(target);\n        });\n      });\n      if (this.moveUpFieldButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.moveUpFieldButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function (target) {\n            return _this._moveUpField(target);\n          });\n        });\n      }\n      if (this.moveDownFieldButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.moveDownFieldButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function (target) {\n            return _this._moveDownField(target);\n          });\n        });\n      }\n    }\n  }, {\n    key: \"_bindSafeEvent\",\n    value: function _bindSafeEvent(event, cb) {\n      event.preventDefault();\n      event.stopPropagation();\n      try {\n        return cb(event.target);\n      } catch (error) {\n        console.error(error); // eslint-disable-line no-console\n        return error;\n      }\n    }\n\n    // Adds a field.\n    //\n    // template - A String matching the type of the template. Expected to be\n    //  either \".decidim-question-template\" or \".decidim-separator-template\".\n  }, {\n    key: \"_addField\",\n    value: function _addField() {\n      var templateClass = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \".decidim-template\";\n      var $wrapper = $(this.wrapperSelector);\n      var $container = $wrapper.find(this.containerSelector);\n\n      // Allow defining the template using a `data-template` attribute on the\n      // wrapper element. This is to allow child templates which would otherwise\n      // be impossible using `<script type=\"text/template\">`. See the comment\n      // below regarding the `<template>` tag and IE11.\n      var templateSelector = $wrapper.data(\"template\");\n      var $template = null;\n      if (templateSelector) {\n        $template = $(templateSelector);\n      }\n      if ($template === null || $template.length < 1) {\n        // To preserve IE11 backwards compatibility, the views are using\n        // `<script type=\"text/template\">` with a given `class` instead of\n        // `<template>`. The `<template> tags are parsed in IE11 along with the\n        // DOM which may cause the form elements inside them to break the forms\n        // as they are submitted with them.\n        $template = $wrapper.children(\"template, \".concat(templateClass));\n      }\n      var $newField = $($template.html()).template(this.placeholderId, this._getUID());\n      $newField.find(\"ul.tabs\").attr(\"data-tabs\", true);\n      var $lastQuestion = $container.find(this.fieldSelector).last();\n      if ($lastQuestion.length > 0) {\n        $lastQuestion.after($newField);\n      } else {\n        $newField.appendTo($container);\n      }\n      $newField.foundation();\n      if (this.onAddField) {\n        this.onAddField($newField);\n      }\n    }\n  }, {\n    key: \"_removeField\",\n    value: function _removeField(target) {\n      var $target = $(target);\n      var $removedField = $target.parents(this.fieldSelector);\n      var idInput = $removedField.find(\"input\").filter(function (idx, input) {\n        return input.name.match(/id/);\n      });\n      if (idInput.length > 0) {\n        var deletedInput = $removedField.find(\"input\").filter(function (idx, input) {\n          return input.name.match(/delete/);\n        });\n        if (deletedInput.length > 0) {\n          $(deletedInput[0]).val(true);\n        }\n        $removedField.addClass(\"hidden\");\n        $removedField.hide();\n      } else {\n        $removedField.remove();\n      }\n      if (this.onRemoveField) {\n        this.onRemoveField($removedField);\n      }\n    }\n  }, {\n    key: \"_moveUpField\",\n    value: function _moveUpField(target) {\n      var $target = $(target);\n      var $movedUpField = $target.parents(this.fieldSelector);\n      $movedUpField.prev().before($movedUpField);\n      if (this.onMoveUpField) {\n        this.onMoveUpField($movedUpField);\n      }\n    }\n  }, {\n    key: \"_moveDownField\",\n    value: function _moveDownField(target) {\n      var $target = $(target);\n      var $movedDownField = $target.parents(this.fieldSelector);\n      $movedDownField.next().after($movedDownField);\n      if (this.onMoveDownField) {\n        this.onMoveDownField($movedDownField);\n      }\n    }\n  }, {\n    key: \"_activateFields\",\n    value: function _activateFields() {\n      var _this2 = this;\n      // Move the `<script type=\"text/template\">` elements to the bottom of the\n      // list container so that they will not cause the question moving\n      // functionality to break since it assumes that all children elements are\n      // the dynamic field list child items.\n      var $wrapper = $(this.wrapperSelector);\n      var $container = $wrapper.find(this.containerSelector);\n      $container.append($container.find(\"script\"));\n      $(this.fieldSelector).each(function (idx, el) {\n        $(el).template(_this2.placeholderId, _this2._getUID());\n        $(el).find(\"ul.tabs\").attr(\"data-tabs\", true);\n      });\n    }\n  }, {\n    key: \"_getUID\",\n    value: function _getUID() {\n      this.elementCounter += 1;\n      return new Date().getTime() + this.elementCounter;\n    }\n  }]);\n  return DynamicFieldsComponent;\n}();\nexport default function createDynamicFields(options) {\n  return new DynamicFieldsComponent(options);\n}","map":{"version":3,"mappings":"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","names":["DynamicFieldsComponent","options","_classCallCheck","wrapperSelector","containerSelector","fieldSelector","addFieldButtonSelector","addSeparatorButtonSelector","addTitleAndDescriptionButtonSelector","fieldTemplateSelector","separatorTemplateSelector","TitleAndDescriptionTemplateSelector","removeFieldButtonSelector","moveUpFieldButtonSelector","moveDownFieldButtonSelector","onAddField","onRemoveField","onMoveUpField","onMoveDownField","placeholderId","elementCounter","_enableInterpolation","_activateFields","_bindEvents","_createClass","key","value","$","fn","replaceAttribute","attribute","placeholder","find","addBack","each","index","element","attr","replace","template","$subtemplate","length","html","oldHtml","outerHTML","$subtemplateParents","_i","elem","$self","$tpl","data","$subtpl","subtemplateId","subtemplateSelector","after","on","event","_this","_bindSafeEvent","_addField","target","_removeField","_moveUpField","_moveDownField","cb","preventDefault","stopPropagation","error","console","templateClass","$wrapper","$container","templateSelector","$template","children","$newField","_getUID","$lastQuestion","last","appendTo","foundation","$target","$removedField","parents","idInput","filter","idx","input","name","match","deletedInput","val","addClass","hide","remove","$movedUpField","prev","before","$movedDownField","next","append","el","_this2","Date","getTime","createDynamicFields"],"sources":["/home/alan/.rvm/gems/ruby-3.0.3/gems/decidim-admin-0.27.0/app/packs/src/decidim/admin/dynamic_fields.component.js"],"sourcesContent":["/* eslint-disable require-jsdoc */\nclass DynamicFieldsComponent {\n  constructor(options = {}) {\n    this.wrapperSelector = options.wrapperSelector;\n    this.containerSelector = options.containerSelector;\n    this.fieldSelector = options.fieldSelector;\n    this.addFieldButtonSelector = options.addFieldButtonSelector;\n    this.addSeparatorButtonSelector = options.addSeparatorButtonSelector;\n    this.addTitleAndDescriptionButtonSelector = options.addTitleAndDescriptionButtonSelector;\n    this.fieldTemplateSelector = options.fieldTemplateSelector;\n    this.separatorTemplateSelector = options.separatorTemplateSelector;\n    this.TitleAndDescriptionTemplateSelector = options.TitleAndDescriptionTemplateSelector;\n    this.removeFieldButtonSelector = options.removeFieldButtonSelector;\n    this.moveUpFieldButtonSelector = options.moveUpFieldButtonSelector;\n    this.moveDownFieldButtonSelector = options.moveDownFieldButtonSelector;\n    this.onAddField = options.onAddField;\n    this.onRemoveField = options.onRemoveField;\n    this.onMoveUpField = options.onMoveUpField;\n    this.onMoveDownField = options.onMoveDownField;\n    this.placeholderId = options.placeholderId;\n    this.elementCounter = 0;\n    this._enableInterpolation();\n    this._activateFields();\n    this._bindEvents();\n  }\n\n  _enableInterpolation() {\n    $.fn.replaceAttribute = function(attribute, placeholder, value) {\n      $(this).find(`[${attribute}*=${placeholder}]`).addBack(`[${attribute}*=${placeholder}]`).each((index, element) => {\n        $(element).attr(attribute, $(element).attr(attribute).replace(placeholder, value));\n      });\n\n      return this;\n    }\n\n    $.fn.template = function(placeholder, value) {\n      // See the comment below in the `_addField()` method regarding the\n      // `<template>` tag support in IE11.\n      const $subtemplate = $(this).find(\"template, .decidim-template\");\n\n      if ($subtemplate.length > 0) {\n        $subtemplate.html((index, oldHtml) => $(oldHtml).template(placeholder, value)[0].outerHTML);\n      }\n\n      // Handle those subtemplates that are mapped with the `data-template`\n      // attribute. This is also because of the IE11 support.\n      const $subtemplateParents = $(this).find(\"[data-template]\");\n\n      if ($subtemplateParents.length > 0) {\n        $subtemplateParents.each((_i, elem) => {\n          const $self = $(elem);\n          const $tpl = $($self.data(\"template\"));\n\n          // Duplicate the sub-template with a unique ID as there may be\n          // multiple parent templates referring to the same sub-template.\n          const $subtpl = $($tpl[0].outerHTML);\n          const subtemplateId = `${$tpl.attr(\"id\")}-${value}`;\n          const subtemplateSelector = `#${subtemplateId}`;\n          $subtpl.attr(\"id\", subtemplateId);\n          $self.attr(\"data-template\", subtemplateSelector).data(\"template\", subtemplateSelector);\n          $tpl.after($subtpl);\n\n          $subtpl.html((index, oldHtml) => $(oldHtml).template(placeholder, value)[0].outerHTML);\n        });\n      }\n\n      $(this).replaceAttribute(\"id\", placeholder, value);\n      $(this).replaceAttribute(\"name\", placeholder, value);\n      $(this).replaceAttribute(\"data-tabs-content\", placeholder, value);\n      $(this).replaceAttribute(\"for\", placeholder, value);\n      $(this).replaceAttribute(\"tabs_id\", placeholder, value);\n      $(this).replaceAttribute(\"href\", placeholder, value);\n      $(this).replaceAttribute(\"value\", placeholder, value);\n\n      return this;\n    }\n  }\n\n  _bindEvents() {\n    $(this.wrapperSelector).on(\"click\", this.addFieldButtonSelector, (event) =>\n      this._bindSafeEvent(event, () => this._addField(this.fieldTemplateSelector))\n    );\n\n    if (this.addSeparatorButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.addSeparatorButtonSelector, (event) =>\n        this._bindSafeEvent(event, () => this._addField(this.separatorTemplateSelector))\n      );\n    }\n\n    if (this.addTitleAndDescriptionButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.addTitleAndDescriptionButtonSelector, (event) =>\n        this._bindSafeEvent(event, () => this._addField(this.TitleAndDescriptionTemplateSelector))\n      );\n    }\n\n    $(this.wrapperSelector).on(\"click\", this.removeFieldButtonSelector, (event) =>\n      this._bindSafeEvent(event, (target) => this._removeField(target))\n    );\n\n    if (this.moveUpFieldButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.moveUpFieldButtonSelector, (event) =>\n        this._bindSafeEvent(event, (target) => this._moveUpField(target))\n      );\n    }\n\n    if (this.moveDownFieldButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.moveDownFieldButtonSelector, (event) =>\n        this._bindSafeEvent(event, (target) => this._moveDownField(target))\n      );\n    }\n  }\n\n  _bindSafeEvent(event, cb) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    try {\n      return cb(event.target);\n    } catch (error) {\n      console.error(error); // eslint-disable-line no-console\n      return error;\n    }\n  }\n\n  // Adds a field.\n  //\n  // template - A String matching the type of the template. Expected to be\n  //  either \".decidim-question-template\" or \".decidim-separator-template\".\n  _addField(templateClass = \".decidim-template\") {\n    const $wrapper = $(this.wrapperSelector);\n    const $container = $wrapper.find(this.containerSelector);\n\n    // Allow defining the template using a `data-template` attribute on the\n    // wrapper element. This is to allow child templates which would otherwise\n    // be impossible using `<script type=\"text/template\">`. See the comment\n    // below regarding the `<template>` tag and IE11.\n    const templateSelector = $wrapper.data(\"template\");\n    let $template = null;\n    if (templateSelector) {\n      $template = $(templateSelector);\n    }\n    if ($template === null || $template.length < 1) {\n      // To preserve IE11 backwards compatibility, the views are using\n      // `<script type=\"text/template\">` with a given `class` instead of\n      // `<template>`. The `<template> tags are parsed in IE11 along with the\n      // DOM which may cause the form elements inside them to break the forms\n      // as they are submitted with them.\n      $template = $wrapper.children(`template, ${templateClass}`);\n    }\n\n    const $newField = $($template.html()).template(this.placeholderId, this._getUID());\n\n    $newField.find(\"ul.tabs\").attr(\"data-tabs\", true);\n\n    const $lastQuestion = $container.find(this.fieldSelector).last()\n    if ($lastQuestion.length > 0) {\n      $lastQuestion.after($newField);\n    } else {\n      $newField.appendTo($container);\n    }\n\n    $newField.foundation();\n\n    if (this.onAddField) {\n      this.onAddField($newField);\n    }\n  }\n\n  _removeField(target) {\n    const $target = $(target);\n    const $removedField = $target.parents(this.fieldSelector);\n    const idInput = $removedField.find(\"input\").filter((idx, input) => input.name.match(/id/));\n\n    if (idInput.length > 0) {\n      const deletedInput = $removedField.find(\"input\").filter((idx, input) => input.name.match(/delete/));\n\n      if (deletedInput.length > 0) {\n        $(deletedInput[0]).val(true);\n      }\n\n      $removedField.addClass(\"hidden\");\n      $removedField.hide();\n    } else {\n      $removedField.remove();\n    }\n\n    if (this.onRemoveField) {\n      this.onRemoveField($removedField);\n    }\n  }\n\n  _moveUpField(target) {\n    const $target = $(target);\n    const $movedUpField = $target.parents(this.fieldSelector);\n\n    $movedUpField.prev().before($movedUpField);\n\n    if (this.onMoveUpField) {\n      this.onMoveUpField($movedUpField);\n    }\n  }\n\n  _moveDownField(target) {\n    const $target = $(target);\n    const $movedDownField = $target.parents(this.fieldSelector);\n\n    $movedDownField.next().after($movedDownField);\n\n    if (this.onMoveDownField) {\n      this.onMoveDownField($movedDownField);\n    }\n  }\n\n  _activateFields() {\n    // Move the `<script type=\"text/template\">` elements to the bottom of the\n    // list container so that they will not cause the question moving\n    // functionality to break since it assumes that all children elements are\n    // the dynamic field list child items.\n    const $wrapper = $(this.wrapperSelector);\n    const $container = $wrapper.find(this.containerSelector);\n    $container.append($container.find(\"script\"));\n\n    $(this.fieldSelector).each((idx, el) => {\n      $(el).template(this.placeholderId, this._getUID());\n\n      $(el).find(\"ul.tabs\").attr(\"data-tabs\", true);\n    })\n  }\n\n  _getUID() {\n    this.elementCounter += 1;\n\n    return (new Date().getTime()) + this.elementCounter;\n  }\n}\n\nexport default function createDynamicFields(options) {\n  return new DynamicFieldsComponent(options);\n}\n"]},"metadata":{},"sourceType":"module"}