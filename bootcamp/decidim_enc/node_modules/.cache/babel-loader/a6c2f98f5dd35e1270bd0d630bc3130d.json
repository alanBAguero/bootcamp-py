{"ast":null,"code":"function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n  return arr2;\n}\nimport ConsentManager from \"src/decidim/data_consent/consent_manager\";\nvar initDialog = function initDialog(manager) {\n  if (Object.keys(manager.state).length > 0) {\n    return;\n  }\n  var dialogWrapper = document.querySelector(\"#dc-dialog-wrapper\");\n  dialogWrapper.classList.remove(\"hide\");\n  var acceptAllButton = dialogWrapper.querySelector(\"#dc-dialog-accept\");\n  var rejectAllButton = dialogWrapper.querySelector(\"#dc-dialog-reject\");\n  var settingsButton = dialogWrapper.querySelector(\"#dc-dialog-settings\");\n  acceptAllButton.addEventListener(\"click\", function () {\n    manager.acceptAll();\n    dialogWrapper.style.display = \"none\";\n  });\n  rejectAllButton.addEventListener(\"click\", function () {\n    manager.rejectAll();\n    dialogWrapper.style.display = \"none\";\n  });\n  settingsButton.addEventListener(\"click\", function () {\n    dialogWrapper.style.display = \"none\";\n  });\n};\nvar initModal = function initModal(manager) {\n  var categoryElements = manager.modal.querySelectorAll(\".category-wrapper\");\n  categoryElements.forEach(function (categoryEl) {\n    var categoryButton = categoryEl.querySelector(\".dc-title\");\n    var categoryDescription = categoryEl.querySelector(\".dc-description\");\n    categoryButton.addEventListener(\"click\", function () {\n      var hidden = categoryDescription.classList.contains(\"hide\");\n      if (hidden) {\n        categoryButton.classList.add(\"open\");\n        categoryDescription.classList.remove(\"hide\");\n      } else {\n        categoryButton.classList.remove(\"open\");\n        categoryDescription.classList.add(\"hide\");\n      }\n    });\n  });\n  var acceptAllButton = manager.modal.querySelector(\"#dc-modal-accept\");\n  var rejectAllButton = manager.modal.querySelector(\"#dc-modal-reject\");\n  var saveSettingsButton = manager.modal.querySelector(\"#dc-modal-save\");\n  acceptAllButton.addEventListener(\"click\", function () {\n    manager.acceptAll();\n  });\n  rejectAllButton.addEventListener(\"click\", function () {\n    manager.rejectAll();\n  });\n  saveSettingsButton.addEventListener(\"click\", function () {\n    var newState = {};\n    manager.categories.forEach(function (category) {\n      var accepted = manager.modal.querySelector(\"input[name='\".concat(category, \"']\")).checked;\n      if (accepted) {\n        newState[category] = true;\n      }\n    });\n    manager.saveSettings(newState);\n  });\n};\nvar initDisabledIframes = function initDisabledIframes(manager) {\n  var disabledIframes = document.querySelectorAll(\".disabled-iframe\");\n  if (manager.allAccepted()) {\n    disabledIframes.forEach(function (elem) {\n      var iframe = document.createElement(\"iframe\");\n      iframe.setAttribute(\"src\", elem.getAttribute(\"src\"));\n      iframe.className = elem.classList.toString();\n      iframe.setAttribute(\"allowfullscreen\", elem.getAttribute(\"allowfullscreen\"));\n      iframe.setAttribute(\"frameborder\", elem.getAttribute(\"frameborder\"));\n      elem.parentElement.appendChild(iframe);\n      elem.remove();\n    });\n  }\n};\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  var modal = document.querySelector(\"#dc-modal\");\n  if (!modal) {\n    return;\n  }\n  var categories = _toConsumableArray(modal.querySelectorAll(\".category-wrapper\")).map(function (el) {\n    return el.dataset.id;\n  });\n  var manager = new ConsentManager({\n    modal: modal,\n    categories: categories,\n    cookieName: window.Decidim.config.get(\"consent_cookie_name\"),\n    warningElement: document.querySelector(\".dataconsent-warning\")\n  });\n  initDisabledIframes(manager);\n  initModal(manager, categories);\n  initDialog(manager);\n});","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,cAAc,MAAM,0CAA0C;AAErE,IAAMC,UAAU,GAAG,SAAbA,UAAU,CAAIC,OAAO,EAAK;EAC9B,IAAIC,MAAM,CAACC,IAAI,CAACF,OAAO,CAACG,KAAK,CAAC,CAACC,MAAM,GAAG,CAAC,EAAE;IACzC;EACF;EACA,IAAMC,aAAa,GAAGC,QAAQ,CAACC,aAAa,CAAC,oBAAoB,CAAC;EAClEF,aAAa,CAACG,SAAS,CAACC,MAAM,CAAC,MAAM,CAAC;EAEtC,IAAMC,eAAe,GAAGL,aAAa,CAACE,aAAa,CAAC,mBAAmB,CAAC;EACxE,IAAMI,eAAe,GAAGN,aAAa,CAACE,aAAa,CAAC,mBAAmB,CAAC;EACxE,IAAMK,cAAc,GAAGP,aAAa,CAACE,aAAa,CAAC,qBAAqB,CAAC;EAEzEG,eAAe,CAACG,gBAAgB,CAAC,OAAO,EAAE,YAAM;IAC9Cb,OAAO,CAACc,SAAS,EAAE;IACnBT,aAAa,CAACU,KAAK,CAACC,OAAO,GAAG,MAAM;EACtC,CAAC,CAAC;EAEFL,eAAe,CAACE,gBAAgB,CAAC,OAAO,EAAE,YAAM;IAC9Cb,OAAO,CAACiB,SAAS,EAAE;IACnBZ,aAAa,CAACU,KAAK,CAACC,OAAO,GAAG,MAAM;EACtC,CAAC,CAAC;EAEFJ,cAAc,CAACC,gBAAgB,CAAC,OAAO,EAAE,YAAM;IAC7CR,aAAa,CAACU,KAAK,CAACC,OAAO,GAAG,MAAM;EACtC,CAAC,CAAC;AACJ,CAAC;AAED,IAAME,SAAS,GAAG,SAAZA,SAAS,CAAIlB,OAAO,EAAK;EAC7B,IAAMmB,gBAAgB,GAAGnB,OAAO,CAACoB,KAAK,CAACC,gBAAgB,CAAC,mBAAmB,CAAC;EAE5EF,gBAAgB,CAACG,OAAO,CAAC,UAACC,UAAU,EAAK;IACvC,IAAMC,cAAc,GAAGD,UAAU,CAAChB,aAAa,CAAC,WAAW,CAAC;IAC5D,IAAMkB,mBAAmB,GAAGF,UAAU,CAAChB,aAAa,CAAC,iBAAiB,CAAC;IACvEiB,cAAc,CAACX,gBAAgB,CAAC,OAAO,EAAE,YAAM;MAC7C,IAAMa,MAAM,GAAGD,mBAAmB,CAACjB,SAAS,CAACmB,QAAQ,CAAC,MAAM,CAAC;MAC7D,IAAID,MAAM,EAAE;QACVF,cAAc,CAAChB,SAAS,CAACoB,GAAG,CAAC,MAAM,CAAC;QACpCH,mBAAmB,CAACjB,SAAS,CAACC,MAAM,CAAC,MAAM,CAAC;MAC9C,CAAC,MAAM;QACLe,cAAc,CAAChB,SAAS,CAACC,MAAM,CAAC,MAAM,CAAC;QACvCgB,mBAAmB,CAACjB,SAAS,CAACoB,GAAG,CAAC,MAAM,CAAC;MAC3C;IACF,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,IAAMlB,eAAe,GAAGV,OAAO,CAACoB,KAAK,CAACb,aAAa,CAAC,kBAAkB,CAAC;EACvE,IAAMI,eAAe,GAAGX,OAAO,CAACoB,KAAK,CAACb,aAAa,CAAC,kBAAkB,CAAC;EACvE,IAAMsB,kBAAkB,GAAG7B,OAAO,CAACoB,KAAK,CAACb,aAAa,CAAC,gBAAgB,CAAC;EAExEG,eAAe,CAACG,gBAAgB,CAAC,OAAO,EAAE,YAAM;IAC9Cb,OAAO,CAACc,SAAS,EAAE;EACrB,CAAC,CAAC;EAEFH,eAAe,CAACE,gBAAgB,CAAC,OAAO,EAAE,YAAM;IAC9Cb,OAAO,CAACiB,SAAS,EAAE;EACrB,CAAC,CAAC;EAEFY,kBAAkB,CAAChB,gBAAgB,CAAC,OAAO,EAAE,YAAM;IACjD,IAAIiB,QAAQ,GAAG,CAAC,CAAC;IACjB9B,OAAO,CAAC+B,UAAU,CAACT,OAAO,CAAC,UAACU,QAAQ,EAAK;MACvC,IAAMC,QAAQ,GAAGjC,OAAO,CAACoB,KAAK,CAACb,aAAa,uBAAgByB,QAAQ,QAAK,CAACE,OAAO;MACjF,IAAID,QAAQ,EAAE;QACZH,QAAQ,CAACE,QAAQ,CAAC,GAAG,IAAI;MAC3B;IACF,CAAC,CAAC;IACFhC,OAAO,CAACmC,YAAY,CAACL,QAAQ,CAAC;EAChC,CAAC,CAAC;AACJ,CAAC;AAED,IAAMM,mBAAmB,GAAG,SAAtBA,mBAAmB,CAAIpC,OAAO,EAAK;EACvC,IAAMqC,eAAe,GAAG/B,QAAQ,CAACe,gBAAgB,CAAC,kBAAkB,CAAC;EACrE,IAAIrB,OAAO,CAACsC,WAAW,EAAE,EAAE;IACzBD,eAAe,CAACf,OAAO,CAAC,UAACiB,IAAI,EAAK;MAChC,IAAMC,MAAM,GAAGlC,QAAQ,CAACmC,aAAa,CAAC,QAAQ,CAAC;MAC/CD,MAAM,CAACE,YAAY,CAAC,KAAK,EAAEH,IAAI,CAACI,YAAY,CAAC,KAAK,CAAC,CAAC;MACpDH,MAAM,CAACI,SAAS,GAAGL,IAAI,CAAC/B,SAAS,CAACqC,QAAQ,EAAE;MAC5CL,MAAM,CAACE,YAAY,CAAC,iBAAiB,EAAEH,IAAI,CAACI,YAAY,CAAC,iBAAiB,CAAC,CAAC;MAC5EH,MAAM,CAACE,YAAY,CAAC,aAAa,EAAEH,IAAI,CAACI,YAAY,CAAC,aAAa,CAAC,CAAC;MACpEJ,IAAI,CAACO,aAAa,CAACC,WAAW,CAACP,MAAM,CAAC;MACtCD,IAAI,CAAC9B,MAAM,EAAE;IACf,CAAC,CAAC;EACJ;AACF,CAAC;AAEDH,QAAQ,CAACO,gBAAgB,CAAC,kBAAkB,EAAE,YAAM;EAClD,IAAMO,KAAK,GAAGd,QAAQ,CAACC,aAAa,CAAC,WAAW,CAAC;EACjD,IAAI,CAACa,KAAK,EAAE;IACV;EACF;EAEA,IAAMW,UAAU,GAAGiB,mBAAI5B,KAAK,CAACC,gBAAgB,CAAC,mBAAmB,CAAC,EAAE4B,GAAG,CAAC,UAACC,EAAE;IAAA,OAAKA,EAAE,CAACC,OAAO,CAACC,EAAE;EAAA,EAAC;EAC9F,IAAMpD,OAAO,GAAG,IAAIF,cAAc,CAAC;IACjCsB,KAAK,EAAEA,KAAK;IACZW,UAAU,EAAEA,UAAU;IACtBsB,UAAU,EAAEC,MAAM,CAACC,OAAO,CAACC,MAAM,CAACC,GAAG,CAAC,qBAAqB,CAAC;IAC5DC,cAAc,EAAEpD,QAAQ,CAACC,aAAa,CAAC,sBAAsB;EAC/D,CAAC,CAAC;EAEF6B,mBAAmB,CAACpC,OAAO,CAAC;EAC5BkB,SAAS,CAAClB,OAAO,EAAE+B,UAAU,CAAC;EAC9BhC,UAAU,CAACC,OAAO,CAAC;AACrB,CAAC,CAAC","names":["ConsentManager","initDialog","manager","Object","keys","state","length","dialogWrapper","document","querySelector","classList","remove","acceptAllButton","rejectAllButton","settingsButton","addEventListener","acceptAll","style","display","rejectAll","initModal","categoryElements","modal","querySelectorAll","forEach","categoryEl","categoryButton","categoryDescription","hidden","contains","add","saveSettingsButton","newState","categories","category","accepted","checked","saveSettings","initDisabledIframes","disabledIframes","allAccepted","elem","iframe","createElement","setAttribute","getAttribute","className","toString","parentElement","appendChild","_toConsumableArray","map","el","dataset","id","cookieName","window","Decidim","config","get","warningElement"],"sources":["/home/alan/.rvm/gems/ruby-3.0.3/gems/decidim-core-0.27.0/app/packs/src/decidim/data_consent/index.js"],"sourcesContent":["import ConsentManager from \"src/decidim/data_consent/consent_manager\";\n\nconst initDialog = (manager) => {\n  if (Object.keys(manager.state).length > 0) {\n    return;\n  }\n  const dialogWrapper = document.querySelector(\"#dc-dialog-wrapper\");\n  dialogWrapper.classList.remove(\"hide\");\n\n  const acceptAllButton = dialogWrapper.querySelector(\"#dc-dialog-accept\");\n  const rejectAllButton = dialogWrapper.querySelector(\"#dc-dialog-reject\");\n  const settingsButton = dialogWrapper.querySelector(\"#dc-dialog-settings\");\n\n  acceptAllButton.addEventListener(\"click\", () => {\n    manager.acceptAll();\n    dialogWrapper.style.display = \"none\";\n  });\n\n  rejectAllButton.addEventListener(\"click\", () => {\n    manager.rejectAll();\n    dialogWrapper.style.display = \"none\";\n  });\n\n  settingsButton.addEventListener(\"click\", () => {\n    dialogWrapper.style.display = \"none\";\n  });\n}\n\nconst initModal = (manager) => {\n  const categoryElements = manager.modal.querySelectorAll(\".category-wrapper\");\n\n  categoryElements.forEach((categoryEl) => {\n    const categoryButton = categoryEl.querySelector(\".dc-title\");\n    const categoryDescription = categoryEl.querySelector(\".dc-description\");\n    categoryButton.addEventListener(\"click\", () => {\n      const hidden = categoryDescription.classList.contains(\"hide\");\n      if (hidden) {\n        categoryButton.classList.add(\"open\");\n        categoryDescription.classList.remove(\"hide\");\n      } else {\n        categoryButton.classList.remove(\"open\");\n        categoryDescription.classList.add(\"hide\");\n      }\n    })\n  })\n\n  const acceptAllButton = manager.modal.querySelector(\"#dc-modal-accept\");\n  const rejectAllButton = manager.modal.querySelector(\"#dc-modal-reject\");\n  const saveSettingsButton = manager.modal.querySelector(\"#dc-modal-save\");\n\n  acceptAllButton.addEventListener(\"click\", () => {\n    manager.acceptAll();\n  })\n\n  rejectAllButton.addEventListener(\"click\", () => {\n    manager.rejectAll();\n  })\n\n  saveSettingsButton.addEventListener(\"click\", () => {\n    let newState = {};\n    manager.categories.forEach((category) => {\n      const accepted = manager.modal.querySelector(`input[name='${category}']`).checked;\n      if (accepted) {\n        newState[category] = true;\n      }\n    })\n    manager.saveSettings(newState);\n  })\n}\n\nconst initDisabledIframes = (manager) => {\n  const disabledIframes = document.querySelectorAll(\".disabled-iframe\")\n  if (manager.allAccepted()) {\n    disabledIframes.forEach((elem) => {\n      const iframe = document.createElement(\"iframe\")\n      iframe.setAttribute(\"src\", elem.getAttribute(\"src\"));\n      iframe.className = elem.classList.toString();\n      iframe.setAttribute(\"allowfullscreen\", elem.getAttribute(\"allowfullscreen\"));\n      iframe.setAttribute(\"frameborder\", elem.getAttribute(\"frameborder\"));\n      elem.parentElement.appendChild(iframe);\n      elem.remove();\n    })\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  const modal = document.querySelector(\"#dc-modal\");\n  if (!modal) {\n    return;\n  }\n\n  const categories = [...modal.querySelectorAll(\".category-wrapper\")].map((el) => el.dataset.id)\n  const manager = new ConsentManager({\n    modal: modal,\n    categories: categories,\n    cookieName: window.Decidim.config.get(\"consent_cookie_name\"),\n    warningElement: document.querySelector(\".dataconsent-warning\")\n  });\n\n  initDisabledIframes(manager);\n  initModal(manager, categories);\n  initDialog(manager);\n});\n"]},"metadata":{},"sourceType":"module"}