{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nvar DataPicker = /*#__PURE__*/function () {\n  function DataPicker(pickers) {\n    var _this = this;\n    _classCallCheck(this, DataPicker);\n    this.modal = this._createModalContainer();\n    this.modal.appendTo($(\"body\"));\n    this.current = null;\n    pickers.each(function (_index, picker) {\n      _this.activate(picker);\n    });\n  }\n  _createClass(DataPicker, [{\n    key: \"activate\",\n    value: function activate(picker) {\n      var _this2 = this;\n      var $picker = $(picker);\n      this._setCurrentPicker($picker, null);\n      var input = \"hidden\",\n        name = this.current.name,\n        values = this.current.values;\n      if (this.current.multiple) {\n        name += \"[]\";\n      }\n      $(\"div\", values).each(function (_index2, div) {\n        var value = $(\"a\", div).data(\"picker-value\");\n        $(div).prepend($(\"<input type=\\\"\".concat(input, \"\\\" checked name=\\\"\").concat(name, \"\\\" value=\\\"\").concat(value, \"\\\"/>\")));\n      });\n      $picker.on(\"click\", \"a\", function (event) {\n        event.preventDefault();\n        if ($picker.hasClass(\"disabled\")) {\n          return;\n        }\n        var isMultiPicker = $picker.hasClass(\"picker-multiple\");\n        if ($(_this2._targetFromEvent(event)).hasClass(\"picker-prompt\") || !isMultiPicker) {\n          _this2._openPicker($picker, _this2._targetFromEvent(event));\n        } else if (_this2._targetFromEvent(event).tagName === \"A\") {\n          _this2._removeValue($picker, _this2._targetFromEvent(event).parentNode);\n        } else {\n          _this2._removeValue($picker, _this2._targetFromEvent(event));\n        }\n      });\n      $picker.on(\"click\", \"input\", function (event) {\n        _this2._removeValue($picker, _this2._targetFromEvent(event));\n      });\n      if (this.current.autosort) {\n        this._sort();\n      }\n    }\n  }, {\n    key: \"enabled\",\n    value: function enabled(picker, value) {\n      $(picker).toggleClass(\"disabled\", !value);\n      $(\"input\", picker).attr(\"disabled\", !value);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear(picker) {\n      $(\".picker-values\", picker).html(\"\");\n    }\n  }, {\n    key: \"save\",\n    value: function save(picker) {\n      return $(\".picker-values div:has(input:checked)\", picker).map(function (_index, div) {\n        var $link = $(\"a\", div);\n        return {\n          value: $(\"input\", div).val(),\n          text: $link.text(),\n          url: $link.attr(\"href\")\n        };\n      }).get();\n    }\n  }, {\n    key: \"load\",\n    value: function load(picker, savedData) {\n      var _this3 = this;\n      this._setCurrentPicker($(picker), null);\n      $.each(savedData, function (_index, data) {\n        _this3._choose(data, {\n          interactive: false,\n          modify: false\n        });\n      });\n      if (this.current.autosort) {\n        this._sort();\n      }\n    }\n  }, {\n    key: \"_createModalContainer\",\n    value: function _createModalContainer() {\n      // Add a header because we are referencing the title element with\n      // `aria-labelledby`. If the title doesn't exist, the \"labelled by\"\n      // reference is incorrect.\n      var headerHtml = '<div class=\"scope-picker picker-header\"><h6 id=\"data_picker-title\" class=\"h2\"></h6></div>';\n      return $(\"<div class=\\\"small reveal\\\" id=\\\"data_picker-modal\\\" aria-hidden=\\\"true\\\" aria-live=\\\"assertive\\\" role=\\\"dialog\\\" aria-labelledby=\\\"data_picker-title\\\" data-reveal data-multiple-opened=\\\"true\\\">\\n             <div class=\\\"data_picker-modal-content\\\">\".concat(headerHtml, \"</div>\\n             <button class=\\\"close-button\\\" data-close type=\\\"button\\\" data-reveal-id=\\\"data_picker-modal\\\"><span aria-hidden=\\\"true\\\">&times;</span></button>\\n             </div>\"));\n    }\n  }, {\n    key: \"_openPicker\",\n    value: function _openPicker($picker, target) {\n      this._setCurrentPicker($picker, target);\n      this._load($(\"a\", target).attr(\"href\"));\n    }\n  }, {\n    key: \"_setCurrentPicker\",\n    value: function _setCurrentPicker($picker, target) {\n      var $target = false;\n      if (target && !$(target).hasClass(\"picker-prompt\")) {\n        $target = $(target);\n      }\n      this.current = {\n        picker: $picker,\n        name: $picker.data(\"picker-name\"),\n        values: $picker.find(\".picker-values\"),\n        multiple: $picker.hasClass(\"picker-multiple\"),\n        autosort: $picker.hasClass(\"picker-multiple\") && $picker.hasClass(\"picker-autosort\"),\n        target: $target\n      };\n    }\n  }, {\n    key: \"_load\",\n    value: function _load(url) {\n      var _this4 = this;\n      $.ajax(url).done(function (resp) {\n        var modalContent = $(\".data_picker-modal-content\", _this4.modal);\n        modalContent.html(resp);\n        _this4._handleLinks(modalContent);\n        _this4._handleCheckboxes(modalContent);\n        _this4.modal.foundation(\"open\");\n      });\n    }\n  }, {\n    key: \"_handleLinks\",\n    value: function _handleLinks(content) {\n      var _this5 = this;\n      $(\"a\", content).each(function (_index, link) {\n        var $link = $(link);\n        $link.click(function (event) {\n          event.preventDefault();\n          if ($link.data(\"close\") || $link.data(\"close\") === \"\") {\n            return;\n          }\n          var chooseUrl = $link.attr(\"href\");\n          if (chooseUrl) {\n            if (typeof $link.data(\"picker-choose\") === \"undefined\") {\n              _this5._load(chooseUrl);\n            } else {\n              _this5._choose({\n                url: chooseUrl,\n                value: $link.data(\"picker-value\") || \"\",\n                text: $link.data(\"picker-text\") || \"\"\n              });\n            }\n          }\n        });\n      });\n    }\n  }, {\n    key: \"_handleCheckboxes\",\n    value: function _handleCheckboxes(content) {\n      var _this6 = this;\n      $(\"input[type=checkbox][data-picker-choose]\", content).each(function (_index, checkbox) {\n        var $checkbox = $(checkbox);\n        checkbox.checked = _this6._targetFromValue($checkbox.val()) !== null;\n      }).change(function (event) {\n        var $checkbox = $(event.target);\n        if (event.target.checked) {\n          _this6._choose({\n            url: $checkbox.data(\"picker-url\"),\n            value: $checkbox.val() || \"\",\n            text: $checkbox.data(\"picker-text\") || \"\"\n          }, {\n            modify: false,\n            close: false\n          });\n        } else {\n          _this6._removeValue(_this6.current.picker, _this6._targetFromValue($checkbox.val()));\n        }\n      });\n    }\n  }, {\n    key: \"_choose\",\n    value: function _choose(data) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var options = Object.assign({\n        interactive: true,\n        modify: true,\n        close: true\n      }, opts);\n      var dataText = this._escape(data.text);\n      var choosenOption = null;\n      if (!this.current.target && options.modify) {\n        this.current.target = this._targetFromValue(data.value);\n      }\n\n      // Add or update value appearance\n      if (this.current.target && options.modify) {\n        var link = $(\"a\", this.current.target);\n        link.data(\"picker-value\", data.value);\n        link.attr(\"href\", data.url);\n        choosenOption = this.current.target;\n        if (this.current.multiple) {\n          link.html(\"&times;&nbsp;\".concat(dataText));\n        } else {\n          link.text(dataText);\n        }\n      } else {\n        var input = \"hidden\",\n          name = this.current.name;\n        if (this.current.multiple) {\n          name += \"[]\";\n          choosenOption = $(\"<div><input type=\\\"\".concat(input, \"\\\" checked name=\\\"\").concat(name, \"\\\"/><a href=\\\"\").concat(data.url, \"\\\" data-picker-value=\\\"\").concat(data.value, \"\\\" class=\\\"label primary\\\">&times;&nbsp;\").concat(dataText, \"</a></div>\"));\n        } else {\n          choosenOption = $(\"<div><input type=\\\"\".concat(input, \"\\\" checked name=\\\"\").concat(name, \"\\\"/><a href=\\\"\").concat(data.url, \"\\\" data-picker-value=\\\"\").concat(data.value, \"\\\">\").concat(dataText, \"</a></div>\"));\n        }\n        choosenOption.appendTo(this.current.values);\n        if (!this.current.target) {\n          this.current.target = choosenOption;\n        }\n      }\n\n      // Set input value\n      var $input = $(\"input\", choosenOption);\n      $input.attr(\"value\", data.value);\n      if (this.current.autosort) {\n        this._sort();\n      }\n      if (options.interactive) {\n        // Raise changed event\n        $input.trigger(\"change\");\n        this._removeErrors();\n        if (options.close) {\n          this._close();\n        }\n      }\n    }\n  }, {\n    key: \"_sort\",\n    value: function _sort() {\n      var values = $(\".picker-values\", this.current.picker);\n      values.children().sort(function (item1, item2) {\n        return $(\"input\", item1).val() - $(\"input\", item2).val();\n      }).detach().appendTo(values);\n    }\n  }, {\n    key: \"_close\",\n    value: function _close() {\n      // Close modal and unset target element\n      this.modal.foundation(\"close\");\n      this.current.target = null;\n    }\n  }, {\n    key: \"_removeValue\",\n    value: function _removeValue($picker, target) {\n      var _this7 = this;\n      if (target) {\n        this._setCurrentPicker($picker, target);\n        // Fadeout (with time) doesn't work in system tests\n        var fadeoutTime = 500;\n        if (navigator && navigator.webdriver) {\n          fadeoutTime = 0;\n        }\n        this.current.target.fadeOut(fadeoutTime, function () {\n          _this7.current.target.remove();\n          _this7.current.target = null;\n        });\n      }\n    }\n  }, {\n    key: \"_removeErrors\",\n    value: function _removeErrors() {\n      var parent = this.current.picker.parent();\n      $(\".is-invalid-input\", parent).removeClass(\"is-invalid-input\");\n      $(\".is-invalid-label\", parent).removeClass(\"is-invalid-label\");\n      $(\".form-error.is-visible\", parent).removeClass(\"is-visible\");\n    }\n  }, {\n    key: \"_escape\",\n    value: function _escape(str) {\n      return str.replace(/[\\u00A0-\\u9999<>&]/gim, function (_char) {\n        return \"&#\".concat(_char.charCodeAt(0), \";\");\n      });\n    }\n  }, {\n    key: \"_targetFromEvent\",\n    value: function _targetFromEvent(event) {\n      return event.target.parentNode;\n    }\n  }, {\n    key: \"_targetFromValue\",\n    value: function _targetFromValue(value) {\n      return $(\"[data-picker-value=\".concat(value, \"]\"), this.current.picker).parent()[0] || null;\n    }\n  }]);\n  return DataPicker;\n}();\nexport { DataPicker as default };","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;IAAqBA,UAAU;EAC7B,oBAAYC,OAAO,EAAE;IAAA;IAAAC;IACnB,IAAI,CAACC,KAAK,GAAG,IAAI,CAACC,qBAAqB,EAAE;IACzC,IAAI,CAACD,KAAK,CAACE,QAAQ,CAACC,CAAC,CAAC,MAAM,CAAC,CAAC;IAC9B,IAAI,CAACC,OAAO,GAAG,IAAI;IAEnBN,OAAO,CAACO,IAAI,CAAC,UAACC,MAAM,EAAEC,MAAM,EAAK;MAC/BC,KAAI,CAACC,QAAQ,CAACF,MAAM,CAAC;IACvB,CAAC,CAAC;EACJ;EAACG;IAAAC;IAAAC,OAED,kBAASL,MAAM,EAAE;MAAA;MACf,IAAIM,OAAO,GAAGV,CAAC,CAACI,MAAM,CAAC;MAEvB,IAAI,CAACO,iBAAiB,CAACD,OAAO,EAAE,IAAI,CAAC;MAErC,IAAIE,KAAK,GAAG,QAAQ;QAChBC,IAAI,GAAG,IAAI,CAACZ,OAAO,CAACY,IAAI;QACxBC,MAAM,GAAG,IAAI,CAACb,OAAO,CAACa,MAAM;MAEhC,IAAI,IAAI,CAACb,OAAO,CAACc,QAAQ,EAAE;QACzBF,IAAI,IAAI,IAAI;MACd;MAEAb,CAAC,CAAC,KAAK,EAAEc,MAAM,CAAC,CAACZ,IAAI,CAAC,UAACc,OAAO,EAAEC,GAAG,EAAK;QACtC,IAAIR,KAAK,GAAGT,CAAC,CAAC,GAAG,EAAEiB,GAAG,CAAC,CAACC,IAAI,CAAC,cAAc,CAAC;QAC5ClB,CAAC,CAACiB,GAAG,CAAC,CAACE,OAAO,CAACnB,CAAC,yBAAiBY,KAAK,+BAAmBC,IAAI,wBAAYJ,KAAK,UAAM,CAAC;MACvF,CAAC,CAAC;MAEFC,OAAO,CAACU,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE,UAACC,KAAK,EAAK;QAClCA,KAAK,CAACC,cAAc,EAAE;QACtB,IAAIZ,OAAO,CAACa,QAAQ,CAAC,UAAU,CAAC,EAAE;UAChC;QACF;QACA,IAAMC,aAAa,GAAGd,OAAO,CAACa,QAAQ,CAAC,iBAAiB,CAAC;QAEzD,IAAIvB,CAAC,CAACyB,MAAI,CAACC,gBAAgB,CAACL,KAAK,CAAC,CAAC,CAACE,QAAQ,CAAC,eAAe,CAAC,IAAI,CAACC,aAAa,EAAE;UAC/EC,MAAI,CAACE,WAAW,CAACjB,OAAO,EAAEe,MAAI,CAACC,gBAAgB,CAACL,KAAK,CAAC,CAAC;QACzD,CAAC,MAAO,IAAII,MAAI,CAACC,gBAAgB,CAACL,KAAK,CAAC,CAACO,OAAO,KAAK,GAAG,EAAE;UACxDH,MAAI,CAACI,YAAY,CAACnB,OAAO,EAAEe,MAAI,CAACC,gBAAgB,CAACL,KAAK,CAAC,CAACS,UAAU,CAAC;QACrE,CAAC,MAAM;UACLL,MAAI,CAACI,YAAY,CAACnB,OAAO,EAAEe,MAAI,CAACC,gBAAgB,CAACL,KAAK,CAAC,CAAC;QAC1D;MACF,CAAC,CAAC;MAEFX,OAAO,CAACU,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,UAACC,KAAK,EAAK;QACtCI,MAAI,CAACI,YAAY,CAACnB,OAAO,EAAEe,MAAI,CAACC,gBAAgB,CAACL,KAAK,CAAC,CAAC;MAC1D,CAAC,CAAC;MAEF,IAAI,IAAI,CAACpB,OAAO,CAAC8B,QAAQ,EAAE;QACzB,IAAI,CAACC,KAAK,EAAE;MACd;IACF;EAAC;IAAAxB;IAAAC,OAED,iBAAQL,MAAM,EAAEK,KAAK,EAAE;MACrBT,CAAC,CAACI,MAAM,CAAC,CAAC6B,WAAW,CAAC,UAAU,EAAE,CAACxB,KAAK,CAAC;MACzCT,CAAC,CAAC,OAAO,EAAEI,MAAM,CAAC,CAAC8B,IAAI,CAAC,UAAU,EAAE,CAACzB,KAAK,CAAC;IAC7C;EAAC;IAAAD;IAAAC,OAED,eAAML,MAAM,EAAE;MACZJ,CAAC,CAAC,gBAAgB,EAAEI,MAAM,CAAC,CAAC+B,IAAI,CAAC,EAAE,CAAC;IACtC;EAAC;IAAA3B;IAAAC,OAED,cAAKL,MAAM,EAAE;MACX,OAAOJ,CAAC,CAAC,uCAAuC,EAAEI,MAAM,CAAC,CAACgC,GAAG,CAAC,UAACjC,MAAM,EAAEc,GAAG,EAAK;QAC7E,IAAIoB,KAAK,GAAGrC,CAAC,CAAC,GAAG,EAAEiB,GAAG,CAAC;QACvB,OAAO;UACLR,KAAK,EAAET,CAAC,CAAC,OAAO,EAAEiB,GAAG,CAAC,CAACqB,GAAG,EAAE;UAC5BC,IAAI,EAAEF,KAAK,CAACE,IAAI,EAAE;UAClBC,GAAG,EAAEH,KAAK,CAACH,IAAI,CAAC,MAAM;QACxB,CAAC;MACH,CAAC,CAAC,CAACO,GAAG,EAAE;IACV;EAAC;IAAAjC;IAAAC,OAED,cAAKL,MAAM,EAAEsC,SAAS,EAAE;MAAA;MACtB,IAAI,CAAC/B,iBAAiB,CAACX,CAAC,CAACI,MAAM,CAAC,EAAE,IAAI,CAAC;MACvCJ,CAAC,CAACE,IAAI,CAACwC,SAAS,EAAE,UAACvC,MAAM,EAAEe,IAAI,EAAK;QAClCyB,MAAI,CAACC,OAAO,CAAC1B,IAAI,EAAE;UAAE2B,WAAW,EAAE,KAAK;UAAEC,MAAM,EAAE;QAAM,CAAC,CAAC;MAC3D,CAAC,CAAC;MACF,IAAI,IAAI,CAAC7C,OAAO,CAAC8B,QAAQ,EAAE;QACzB,IAAI,CAACC,KAAK,EAAE;MACd;IACF;EAAC;IAAAxB;IAAAC,OAED,iCAAwB;MACtB;MACA;MACA;MACA,IAAMsC,UAAU,GAAG,2FAA2F;MAE9G,OAAO/C,CAAC,qQAC0C+C,UAAU,iMAE3C;IACnB;EAAC;IAAAvC;IAAAC,OAED,qBAAYC,OAAO,EAAEsC,MAAM,EAAE;MAC3B,IAAI,CAACrC,iBAAiB,CAACD,OAAO,EAAEsC,MAAM,CAAC;MACvC,IAAI,CAACC,KAAK,CAACjD,CAAC,CAAC,GAAG,EAAEgD,MAAM,CAAC,CAACd,IAAI,CAAC,MAAM,CAAC,CAAC;IACzC;EAAC;IAAA1B;IAAAC,OAED,2BAAkBC,OAAO,EAAEsC,MAAM,EAAE;MACjC,IAAIE,OAAO,GAAG,KAAK;MACnB,IAAIF,MAAM,IAAI,CAAChD,CAAC,CAACgD,MAAM,CAAC,CAACzB,QAAQ,CAAC,eAAe,CAAC,EAAE;QAClD2B,OAAO,GAAGlD,CAAC,CAACgD,MAAM,CAAC;MACrB;MAEA,IAAI,CAAC/C,OAAO,GAAG;QACbG,MAAM,EAAEM,OAAO;QACfG,IAAI,EAAEH,OAAO,CAACQ,IAAI,CAAC,aAAa,CAAC;QACjCJ,MAAM,EAAEJ,OAAO,CAACyC,IAAI,CAAC,gBAAgB,CAAC;QACtCpC,QAAQ,EAAEL,OAAO,CAACa,QAAQ,CAAC,iBAAiB,CAAC;QAC7CQ,QAAQ,EAAErB,OAAO,CAACa,QAAQ,CAAC,iBAAiB,CAAC,IAAIb,OAAO,CAACa,QAAQ,CAAC,iBAAiB,CAAC;QACpFyB,MAAM,EAAEE;MACV,CAAC;IACH;EAAC;IAAA1C;IAAAC,OAED,eAAM+B,GAAG,EAAE;MAAA;MACTxC,CAAC,CAACoD,IAAI,CAACZ,GAAG,CAAC,CAACa,IAAI,CAAC,UAACC,IAAI,EAAK;QACzB,IAAIC,YAAY,GAAGvD,CAAC,CAAC,4BAA4B,EAAEwD,MAAI,CAAC3D,KAAK,CAAC;QAC9D0D,YAAY,CAACpB,IAAI,CAACmB,IAAI,CAAC;QACvBE,MAAI,CAACC,YAAY,CAACF,YAAY,CAAC;QAC/BC,MAAI,CAACE,iBAAiB,CAACH,YAAY,CAAC;QACpCC,MAAI,CAAC3D,KAAK,CAAC8D,UAAU,CAAC,MAAM,CAAC;MAC/B,CAAC,CAAC;IACJ;EAAC;IAAAnD;IAAAC,OAED,sBAAamD,OAAO,EAAE;MAAA;MACpB5D,CAAC,CAAC,GAAG,EAAE4D,OAAO,CAAC,CAAC1D,IAAI,CAAC,UAACC,MAAM,EAAE0D,IAAI,EAAK;QACrC,IAAIxB,KAAK,GAAGrC,CAAC,CAAC6D,IAAI,CAAC;QACnBxB,KAAK,CAACyB,KAAK,CAAC,UAACzC,KAAK,EAAK;UACrBA,KAAK,CAACC,cAAc,EAAE;UACtB,IAAIe,KAAK,CAACnB,IAAI,CAAC,OAAO,CAAC,IAAImB,KAAK,CAACnB,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE;YACrD;UACF;UAEA,IAAI6C,SAAS,GAAG1B,KAAK,CAACH,IAAI,CAAC,MAAM,CAAC;UAClC,IAAI6B,SAAS,EAAE;YACb,IAAI,OAAO1B,KAAK,CAACnB,IAAI,CAAC,eAAe,CAAC,KAAK,WAAW,EAAE;cACtD8C,MAAI,CAACf,KAAK,CAACc,SAAS,CAAC;YACvB,CAAC,MAAM;cACLC,MAAI,CAACpB,OAAO,CACV;gBAAEJ,GAAG,EAAEuB,SAAS;gBAAEtD,KAAK,EAAE4B,KAAK,CAACnB,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE;gBAAEqB,IAAI,EAAEF,KAAK,CAACnB,IAAI,CAAC,aAAa,CAAC,IAAI;cAAG,CAAC,CACnG;YACH;UACF;QACF,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;EAAC;IAAAV;IAAAC,OAED,2BAAkBmD,OAAO,EAAE;MAAA;MACzB5D,CAAC,CAAC,0CAA0C,EAAE4D,OAAO,CAAC,CAAC1D,IAAI,CAAC,UAACC,MAAM,EAAE8D,QAAQ,EAAK;QAChF,IAAMC,SAAS,GAAGlE,CAAC,CAACiE,QAAQ,CAAC;QAC7BA,QAAQ,CAACE,OAAO,GAAGC,MAAI,CAACC,gBAAgB,CAACH,SAAS,CAAC5B,GAAG,EAAE,CAAC,KAAK,IAAI;MACpE,CAAC,CAAC,CAACgC,MAAM,CAAC,UAACjD,KAAK,EAAK;QACnB,IAAM6C,SAAS,GAAGlE,CAAC,CAACqB,KAAK,CAAC2B,MAAM,CAAC;QACjC,IAAI3B,KAAK,CAAC2B,MAAM,CAACmB,OAAO,EAAE;UACxBC,MAAI,CAACxB,OAAO,CACV;YAAEJ,GAAG,EAAE0B,SAAS,CAAChD,IAAI,CAAC,YAAY,CAAC;YAAET,KAAK,EAAEyD,SAAS,CAAC5B,GAAG,EAAE,IAAI,EAAE;YAAEC,IAAI,EAAE2B,SAAS,CAAChD,IAAI,CAAC,aAAa,CAAC,IAAI;UAAG,CAAC,EAC9G;YAAE4B,MAAM,EAAE,KAAK;YAAEyB,KAAK,EAAE;UAAM,CAAC,CAChC;QACH,CAAC,MACI;UACHH,MAAI,CAACvC,YAAY,CAACuC,MAAI,CAACnE,OAAO,CAACG,MAAM,EAAEgE,MAAI,CAACC,gBAAgB,CAACH,SAAS,CAAC5B,GAAG,EAAE,CAAC,CAAC;QAChF;MACF,CAAC,CAAC;IACJ;EAAC;IAAA9B;IAAAC,OAED,iBAAQS,IAAI,EAAa;MAAA,IAAXsD,IAAI,uEAAG,CAAC,CAAC;MACrB,IAAMC,OAAO,GAAGC,MAAM,CAACC,MAAM,CAAC;QAAE9B,WAAW,EAAE,IAAI;QAAEC,MAAM,EAAE,IAAI;QAAEyB,KAAK,EAAE;MAAK,CAAC,EAAEC,IAAI,CAAC;MAErF,IAAII,QAAQ,GAAG,IAAI,CAACC,OAAO,CAAC3D,IAAI,CAACqB,IAAI,CAAC;MACtC,IAAIuC,aAAa,GAAG,IAAI;MAExB,IAAI,CAAC,IAAI,CAAC7E,OAAO,CAAC+C,MAAM,IAAIyB,OAAO,CAAC3B,MAAM,EAAE;QAC1C,IAAI,CAAC7C,OAAO,CAAC+C,MAAM,GAAG,IAAI,CAACqB,gBAAgB,CAACnD,IAAI,CAACT,KAAK,CAAC;MACzD;;MAEA;MACA,IAAI,IAAI,CAACR,OAAO,CAAC+C,MAAM,IAAIyB,OAAO,CAAC3B,MAAM,EAAE;QACzC,IAAIe,IAAI,GAAG7D,CAAC,CAAC,GAAG,EAAE,IAAI,CAACC,OAAO,CAAC+C,MAAM,CAAC;QACtCa,IAAI,CAAC3C,IAAI,CAAC,cAAc,EAAEA,IAAI,CAACT,KAAK,CAAC;QACrCoD,IAAI,CAAC3B,IAAI,CAAC,MAAM,EAAEhB,IAAI,CAACsB,GAAG,CAAC;QAC3BsC,aAAa,GAAG,IAAI,CAAC7E,OAAO,CAAC+C,MAAM;QACnC,IAAI,IAAI,CAAC/C,OAAO,CAACc,QAAQ,EAAE;UACzB8C,IAAI,CAAC1B,IAAI,wBAAiByC,QAAQ,EAAG;QACvC,CAAC,MAAM;UACLf,IAAI,CAACtB,IAAI,CAACqC,QAAQ,CAAC;QACrB;MACF,CAAC,MAAM;QACL,IAAIhE,KAAK,GAAG,QAAQ;UAChBC,IAAI,GAAG,IAAI,CAACZ,OAAO,CAACY,IAAI;QAE5B,IAAI,IAAI,CAACZ,OAAO,CAACc,QAAQ,EAAE;UACzBF,IAAI,IAAI,IAAI;UACZiE,aAAa,GAAG9E,CAAC,8BAAsBY,KAAK,+BAAmBC,IAAI,2BAAeK,IAAI,CAACsB,GAAG,oCAAwBtB,IAAI,CAACT,KAAK,qDAAwCmE,QAAQ,gBAAa;QAC3L,CAAC,MAAM;UACLE,aAAa,GAAG9E,CAAC,8BAAsBY,KAAK,+BAAmBC,IAAI,2BAAeK,IAAI,CAACsB,GAAG,oCAAwBtB,IAAI,CAACT,KAAK,gBAAKmE,QAAQ,gBAAa;QACxJ;QACAE,aAAa,CAAC/E,QAAQ,CAAC,IAAI,CAACE,OAAO,CAACa,MAAM,CAAC;QAE3C,IAAI,CAAC,IAAI,CAACb,OAAO,CAAC+C,MAAM,EAAE;UACxB,IAAI,CAAC/C,OAAO,CAAC+C,MAAM,GAAG8B,aAAa;QACrC;MACF;;MAEA;MACA,IAAIC,MAAM,GAAG/E,CAAC,CAAC,OAAO,EAAE8E,aAAa,CAAC;MACtCC,MAAM,CAAC7C,IAAI,CAAC,OAAO,EAAEhB,IAAI,CAACT,KAAK,CAAC;MAEhC,IAAI,IAAI,CAACR,OAAO,CAAC8B,QAAQ,EAAE;QACzB,IAAI,CAACC,KAAK,EAAE;MACd;MAEA,IAAIyC,OAAO,CAAC5B,WAAW,EAAE;QACvB;QACAkC,MAAM,CAACC,OAAO,CAAC,QAAQ,CAAC;QACxB,IAAI,CAACC,aAAa,EAAE;QAEpB,IAAIR,OAAO,CAACF,KAAK,EAAE;UACjB,IAAI,CAACW,MAAM,EAAE;QACf;MACF;IACF;EAAC;IAAA1E;IAAAC,OAED,iBAAQ;MACN,IAAMK,MAAM,GAAGd,CAAC,CAAC,gBAAgB,EAAE,IAAI,CAACC,OAAO,CAACG,MAAM,CAAC;MACvDU,MAAM,CAACqE,QAAQ,EAAE,CAACC,IAAI,CAAC,UAACC,KAAK,EAAEC,KAAK;QAAA,OAAKtF,CAAC,CAAC,OAAO,EAAEqF,KAAK,CAAC,CAAC/C,GAAG,EAAE,GAAGtC,CAAC,CAAC,OAAO,EAAEsF,KAAK,CAAC,CAAChD,GAAG,EAAE;MAAA,EAAC,CAACiD,MAAM,EAAE,CAACxF,QAAQ,CAACe,MAAM,CAAC;IACvH;EAAC;IAAAN;IAAAC,OAED,kBAAS;MACP;MACA,IAAI,CAACZ,KAAK,CAAC8D,UAAU,CAAC,OAAO,CAAC;MAC9B,IAAI,CAAC1D,OAAO,CAAC+C,MAAM,GAAG,IAAI;IAC5B;EAAC;IAAAxC;IAAAC,OAED,sBAAaC,OAAO,EAAEsC,MAAM,EAAE;MAAA;MAC5B,IAAIA,MAAM,EAAE;QACV,IAAI,CAACrC,iBAAiB,CAACD,OAAO,EAAEsC,MAAM,CAAC;QACvC;QACA,IAAIwC,WAAW,GAAG,GAAG;QACrB,IAAIC,SAAS,IAAIA,SAAS,CAACC,SAAS,EAAE;UACpCF,WAAW,GAAG,CAAC;QACjB;QACA,IAAI,CAACvF,OAAO,CAAC+C,MAAM,CAAC2C,OAAO,CAACH,WAAW,EAAE,YAAM;UAC7CI,MAAI,CAAC3F,OAAO,CAAC+C,MAAM,CAAC6C,MAAM,EAAE;UAC5BD,MAAI,CAAC3F,OAAO,CAAC+C,MAAM,GAAG,IAAI;QAC5B,CAAC,CAAC;MACJ;IACF;EAAC;IAAAxC;IAAAC,OAED,yBAAgB;MACd,IAAIqF,MAAM,GAAG,IAAI,CAAC7F,OAAO,CAACG,MAAM,CAAC0F,MAAM,EAAE;MACzC9F,CAAC,CAAC,mBAAmB,EAAE8F,MAAM,CAAC,CAACC,WAAW,CAAC,kBAAkB,CAAC;MAC9D/F,CAAC,CAAC,mBAAmB,EAAE8F,MAAM,CAAC,CAACC,WAAW,CAAC,kBAAkB,CAAC;MAC9D/F,CAAC,CAAC,wBAAwB,EAAE8F,MAAM,CAAC,CAACC,WAAW,CAAC,YAAY,CAAC;IAC/D;EAAC;IAAAvF;IAAAC,OAED,iBAAQuF,GAAG,EAAE;MACX,OAAOA,GAAG,CAACC,OAAO,CAAC,uBAAuB,EAAE,UAAUC,KAAI,EAAE;QAC1D,mBAAYA,KAAI,CAACC,UAAU,CAAC,CAAC,CAAC;MAChC,CAAC,CAAC;IACJ;EAAC;IAAA3F;IAAAC,OAED,0BAAiBY,KAAK,EAAE;MACtB,OAAOA,KAAK,CAAC2B,MAAM,CAAClB,UAAU;IAChC;EAAC;IAAAtB;IAAAC,OAED,0BAAiBA,KAAK,EAAE;MACtB,OAAOT,CAAC,8BAAuBS,KAAK,QAAK,IAAI,CAACR,OAAO,CAACG,MAAM,CAAC,CAAC0F,MAAM,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI;IACnF;EAAC;EAAA;AAAA;AAAA,SA9QkBpG,UAAU","names":["DataPicker","pickers","_classCallCheck","modal","_createModalContainer","appendTo","$","current","each","_index","picker","_this","activate","_createClass","key","value","$picker","_setCurrentPicker","input","name","values","multiple","_index2","div","data","prepend","on","event","preventDefault","hasClass","isMultiPicker","_this2","_targetFromEvent","_openPicker","tagName","_removeValue","parentNode","autosort","_sort","toggleClass","attr","html","map","$link","val","text","url","get","savedData","_this3","_choose","interactive","modify","headerHtml","target","_load","$target","find","ajax","done","resp","modalContent","_this4","_handleLinks","_handleCheckboxes","foundation","content","link","click","chooseUrl","_this5","checkbox","$checkbox","checked","_this6","_targetFromValue","change","close","opts","options","Object","assign","dataText","_escape","choosenOption","$input","trigger","_removeErrors","_close","children","sort","item1","item2","detach","fadeoutTime","navigator","webdriver","fadeOut","_this7","remove","parent","removeClass","str","replace","char","charCodeAt"],"sources":["/home/alan/.rvm/gems/ruby-3.0.3/gems/decidim-core-0.27.0/app/packs/src/decidim/data_picker.js"],"sourcesContent":["export default class DataPicker {\n  constructor(pickers) {\n    this.modal = this._createModalContainer();\n    this.modal.appendTo($(\"body\"));\n    this.current = null;\n\n    pickers.each((_index, picker) => {\n      this.activate(picker);\n    });\n  }\n\n  activate(picker) {\n    let $picker = $(picker);\n\n    this._setCurrentPicker($picker, null);\n\n    let input = \"hidden\",\n        name = this.current.name,\n        values = this.current.values;\n\n    if (this.current.multiple) {\n      name += \"[]\";\n    }\n\n    $(\"div\", values).each((_index2, div) => {\n      let value = $(\"a\", div).data(\"picker-value\");\n      $(div).prepend($(`<input type=\"${input}\" checked name=\"${name}\" value=\"${value}\"/>`));\n    });\n\n    $picker.on(\"click\", \"a\", (event) => {\n      event.preventDefault();\n      if ($picker.hasClass(\"disabled\")) {\n        return;\n      }\n      const isMultiPicker = $picker.hasClass(\"picker-multiple\");\n\n      if ($(this._targetFromEvent(event)).hasClass(\"picker-prompt\") || !isMultiPicker) {\n        this._openPicker($picker, this._targetFromEvent(event));\n      }  else if (this._targetFromEvent(event).tagName === \"A\") {\n        this._removeValue($picker, this._targetFromEvent(event).parentNode);\n      } else {\n        this._removeValue($picker, this._targetFromEvent(event));\n      }\n    });\n\n    $picker.on(\"click\", \"input\", (event) => {\n      this._removeValue($picker, this._targetFromEvent(event));\n    });\n\n    if (this.current.autosort) {\n      this._sort();\n    }\n  }\n\n  enabled(picker, value) {\n    $(picker).toggleClass(\"disabled\", !value);\n    $(\"input\", picker).attr(\"disabled\", !value);\n  }\n\n  clear(picker) {\n    $(\".picker-values\", picker).html(\"\");\n  }\n\n  save(picker) {\n    return $(\".picker-values div:has(input:checked)\", picker).map((_index, div) => {\n      let $link = $(\"a\", div);\n      return {\n        value: $(\"input\", div).val(),\n        text: $link.text(),\n        url: $link.attr(\"href\")\n      };\n    }).get();\n  }\n\n  load(picker, savedData) {\n    this._setCurrentPicker($(picker), null);\n    $.each(savedData, (_index, data) => {\n      this._choose(data, { interactive: false, modify: false });\n    });\n    if (this.current.autosort) {\n      this._sort();\n    }\n  }\n\n  _createModalContainer() {\n    // Add a header because we are referencing the title element with\n    // `aria-labelledby`. If the title doesn't exist, the \"labelled by\"\n    // reference is incorrect.\n    const headerHtml = '<div class=\"scope-picker picker-header\"><h6 id=\"data_picker-title\" class=\"h2\"></h6></div>';\n\n    return $(`<div class=\"small reveal\" id=\"data_picker-modal\" aria-hidden=\"true\" aria-live=\"assertive\" role=\"dialog\" aria-labelledby=\"data_picker-title\" data-reveal data-multiple-opened=\"true\">\n             <div class=\"data_picker-modal-content\">${headerHtml}</div>\n             <button class=\"close-button\" data-close type=\"button\" data-reveal-id=\"data_picker-modal\"><span aria-hidden=\"true\">&times;</span></button>\n             </div>`);\n  }\n\n  _openPicker($picker, target) {\n    this._setCurrentPicker($picker, target);\n    this._load($(\"a\", target).attr(\"href\"));\n  }\n\n  _setCurrentPicker($picker, target) {\n    let $target = false;\n    if (target && !$(target).hasClass(\"picker-prompt\")) {\n      $target = $(target);\n    }\n\n    this.current = {\n      picker: $picker,\n      name: $picker.data(\"picker-name\"),\n      values: $picker.find(\".picker-values\"),\n      multiple: $picker.hasClass(\"picker-multiple\"),\n      autosort: $picker.hasClass(\"picker-multiple\") && $picker.hasClass(\"picker-autosort\"),\n      target: $target\n    };\n  }\n\n  _load(url) {\n    $.ajax(url).done((resp) => {\n      let modalContent = $(\".data_picker-modal-content\", this.modal);\n      modalContent.html(resp);\n      this._handleLinks(modalContent);\n      this._handleCheckboxes(modalContent);\n      this.modal.foundation(\"open\");\n    });\n  }\n\n  _handleLinks(content) {\n    $(\"a\", content).each((_index, link) => {\n      let $link = $(link);\n      $link.click((event) => {\n        event.preventDefault();\n        if ($link.data(\"close\") || $link.data(\"close\") === \"\") {\n          return;\n        }\n\n        let chooseUrl = $link.attr(\"href\");\n        if (chooseUrl) {\n          if (typeof $link.data(\"picker-choose\") === \"undefined\") {\n            this._load(chooseUrl);\n          } else {\n            this._choose(\n              { url: chooseUrl, value: $link.data(\"picker-value\") || \"\", text: $link.data(\"picker-text\") || \"\" }\n            );\n          }\n        }\n      });\n    });\n  }\n\n  _handleCheckboxes(content) {\n    $(\"input[type=checkbox][data-picker-choose]\", content).each((_index, checkbox) => {\n      const $checkbox = $(checkbox);\n      checkbox.checked = this._targetFromValue($checkbox.val()) !== null;\n    }).change((event) => {\n      const $checkbox = $(event.target);\n      if (event.target.checked) {\n        this._choose(\n          { url: $checkbox.data(\"picker-url\"), value: $checkbox.val() || \"\", text: $checkbox.data(\"picker-text\") || \"\" },\n          { modify: false, close: false }\n        );\n      }\n      else {\n        this._removeValue(this.current.picker, this._targetFromValue($checkbox.val()));\n      }\n    });\n  }\n\n  _choose(data, opts = {}) {\n    const options = Object.assign({ interactive: true, modify: true, close: true }, opts);\n\n    let dataText = this._escape(data.text);\n    let choosenOption = null;\n\n    if (!this.current.target && options.modify) {\n      this.current.target = this._targetFromValue(data.value);\n    }\n\n    // Add or update value appearance\n    if (this.current.target && options.modify) {\n      let link = $(\"a\", this.current.target);\n      link.data(\"picker-value\", data.value);\n      link.attr(\"href\", data.url);\n      choosenOption = this.current.target;\n      if (this.current.multiple) {\n        link.html(`&times;&nbsp;${dataText}`);\n      } else {\n        link.text(dataText);\n      }\n    } else {\n      let input = \"hidden\",\n          name = this.current.name;\n\n      if (this.current.multiple) {\n        name += \"[]\";\n        choosenOption = $(`<div><input type=\"${input}\" checked name=\"${name}\"/><a href=\"${data.url}\" data-picker-value=\"${data.value}\" class=\"label primary\">&times;&nbsp;${dataText}</a></div>`);\n      } else {\n        choosenOption = $(`<div><input type=\"${input}\" checked name=\"${name}\"/><a href=\"${data.url}\" data-picker-value=\"${data.value}\">${dataText}</a></div>`);\n      }\n      choosenOption.appendTo(this.current.values);\n\n      if (!this.current.target) {\n        this.current.target = choosenOption;\n      }\n    }\n\n    // Set input value\n    let $input = $(\"input\", choosenOption);\n    $input.attr(\"value\", data.value);\n\n    if (this.current.autosort) {\n      this._sort();\n    }\n\n    if (options.interactive) {\n      // Raise changed event\n      $input.trigger(\"change\");\n      this._removeErrors();\n\n      if (options.close) {\n        this._close();\n      }\n    }\n  }\n\n  _sort() {\n    const values = $(\".picker-values\", this.current.picker);\n    values.children().sort((item1, item2) => $(\"input\", item1).val() - $(\"input\", item2).val()).detach().appendTo(values);\n  }\n\n  _close() {\n    // Close modal and unset target element\n    this.modal.foundation(\"close\");\n    this.current.target = null;\n  }\n\n  _removeValue($picker, target) {\n    if (target) {\n      this._setCurrentPicker($picker, target);\n      // Fadeout (with time) doesn't work in system tests\n      let fadeoutTime = 500;\n      if (navigator && navigator.webdriver) {\n        fadeoutTime = 0;\n      }\n      this.current.target.fadeOut(fadeoutTime, () => {\n        this.current.target.remove();\n        this.current.target = null;\n      });\n    }\n  }\n\n  _removeErrors() {\n    let parent = this.current.picker.parent();\n    $(\".is-invalid-input\", parent).removeClass(\"is-invalid-input\");\n    $(\".is-invalid-label\", parent).removeClass(\"is-invalid-label\");\n    $(\".form-error.is-visible\", parent).removeClass(\"is-visible\");\n  }\n\n  _escape(str) {\n    return str.replace(/[\\u00A0-\\u9999<>&]/gim, function (char) {\n      return `&#${char.charCodeAt(0)};`;\n    });\n  }\n\n  _targetFromEvent(event) {\n    return event.target.parentNode;\n  }\n\n  _targetFromValue(value) {\n    return $(`[data-picker-value=${value}]`, this.current.picker).parent()[0] || null;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}