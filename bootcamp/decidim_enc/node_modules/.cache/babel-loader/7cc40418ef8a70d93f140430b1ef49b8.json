{"ast":null,"code":"import AutoComplete from \"src/decidim/autocomplete\";\nvar updateSubmitButton = function updateSubmitButton($fieldContainer, $selectedItems) {\n  var $form = $fieldContainer.closest(\"form\");\n  if ($form.length < 1) {\n    return;\n  }\n  var $submitButton = $form.find(\"button[type='submit']\");\n  if ($selectedItems.children().length === 0) {\n    $submitButton.prop(\"disabled\", true);\n  } else {\n    $submitButton.prop(\"disabled\", false);\n  }\n};\n$(function () {\n  var $fieldContainer = $(\".multiple-mentions\");\n  if ($fieldContainer.length < 1) {\n    return;\n  }\n  var allMessages = window.Decidim.config.get(\"messages\");\n  var messages = allMessages.mentionsModal || {};\n  var $searchInput = $(\"input\", $fieldContainer);\n  var $selectedItems = $(\"ul.\".concat($searchInput.data().selected));\n  var options = $fieldContainer.data();\n  var selected = [];\n  var iconsPath = window.Decidim.config.get(\"icons_path\");\n  var removeLabel = messages.removeRecipient || \"Remove recipient %name%\";\n  var emptyFocusElement = $fieldContainer[0].querySelector(\".empty-list\");\n  if (!emptyFocusElement) {\n    emptyFocusElement = document.createElement(\"div\");\n    emptyFocusElement.tabIndex = \"-1\";\n    emptyFocusElement.className = \"empty-list\";\n    $selectedItems.before(emptyFocusElement);\n  }\n  updateSubmitButton($fieldContainer, $selectedItems);\n  var autoComplete = new AutoComplete($searchInput[0], {\n    dataMatchKeys: [\"name\", \"nickname\"],\n    dataSource: function dataSource(query, callback) {\n      $.post(\"/api\", {\n        \"query\": \"\\n          {\\n            users(filter:{wildcard:\\\"\".concat(query, \"\\\",excludeIds:[]})\\n              {\\n                id,nickname,name,avatarUrl,__typename,...on UserGroup{membersCount},...on User{\\n                  directMessagesEnabled\\n                }\\n              }\\n          }\")\n      }).then(function (response) {\n        callback(response.data.users);\n      });\n    },\n    dataFilter: function dataFilter(list) {\n      return list.filter(function (item) {\n        return !selected.includes(item.value.id);\n      });\n    },\n    modifyResult: function modifyResult(element, value) {\n      $(element).html(\"\\n        <span class=\\\"author__avatar\\\"><img src=\\\"\".concat(value.avatarUrl, \"\\\" alt=\\\"\").concat(value.name, \"\\\"></span>\\n        <strong>\").concat(value.nickname, \"</strong>\\n        <small>\").concat(value.name, \"</small>\\n      \"));\n      if (value.directMessagesEnabled === \"false\") {\n        $(element).addClass(\"disabled\");\n        $(element).append(\"<span>\".concat($searchInput.data().directMessagesDisabled, \"</span>\"));\n      }\n      if (value.membersCount) {\n        $(element).append(\"<span class=\\\"is-group\\\">\".concat(value.membersCount, \"x <svg class=\\\"icon--members icon\\\"><use href=\\\"\").concat(iconsPath, \"#icon-members\\\"/></svg></span>\"));\n      }\n    }\n  });\n  $searchInput.on(\"selection\", function (event) {\n    var feedback = event.detail;\n    var selection = feedback.selection;\n    var id = selection.value.id;\n    if (selected.length >= 9 || selection.value.directMessagesEnabled === \"false\") {\n      return;\n    }\n    var label = removeLabel.replace(\"%name%\", selection.value.name);\n    $selectedItems.append(\"\\n      <li tabindex=\\\"-1\\\">\\n        <input type=\\\"hidden\\\" name=\\\"\".concat(options.name, \"\\\" value=\\\"\").concat(id, \"\\\">\\n        <img src=\\\"\").concat(selection.value.avatarUrl, \"\\\" class=\\\"author__avatar\\\" alt=\\\"\").concat(selection.value.name, \"\\\">\\n        <b>\").concat(selection.value.name, \"</b>\\n        <button type=\\\"button\\\" class=\\\"float-right\\\" data-remove=\\\"\").concat(id, \"\\\" tabindex=\\\"0\\\" aria-controls=\\\"0\\\" aria-label=\\\"\").concat(label, \"\\\">&times;</button>\\n      </li>\\n    \"));\n    autoComplete.setInput(\"\");\n    selected.push(id);\n    updateSubmitButton($fieldContainer, $selectedItems);\n    $selectedItems.find(\"*[data-remove=\\\"\".concat(id, \"\\\"]\")).on(\"keypress click\", function (evt) {\n      var target = evt.target.parentNode;\n      if (target.tagName === \"LI\") {\n        var focusElement = target.nextElementSibling || target.previousElementSibling || emptyFocusElement;\n        selected = selected.filter(function (identifier) {\n          return identifier !== id;\n        });\n        target.remove();\n        updateSubmitButton($fieldContainer, $selectedItems);\n        focusElement.focus();\n      }\n    });\n  });\n});","map":{"version":3,"mappings":"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","names":["AutoComplete","updateSubmitButton","$fieldContainer","$selectedItems","$form","closest","length","$submitButton","find","children","prop","$","allMessages","window","Decidim","config","get","messages","mentionsModal","$searchInput","data","selected","options","iconsPath","removeLabel","removeRecipient","emptyFocusElement","querySelector","document","createElement","tabIndex","className","before","autoComplete","dataMatchKeys","dataSource","query","callback","post","then","response","users","dataFilter","list","filter","item","includes","value","id","modifyResult","element","html","avatarUrl","name","nickname","directMessagesEnabled","addClass","append","directMessagesDisabled","membersCount","on","event","feedback","detail","selection","label","replace","setInput","push","evt","target","parentNode","tagName","focusElement","nextElementSibling","previousElementSibling","identifier","remove","focus"],"sources":["/home/alan/.rvm/gems/ruby-3.0.3/gems/decidim-core-0.27.0/app/packs/src/decidim/input_multiple_mentions.js"],"sourcesContent":["import AutoComplete from \"src/decidim/autocomplete\";\n\nconst updateSubmitButton = ($fieldContainer, $selectedItems) => {\n  const $form = $fieldContainer.closest(\"form\");\n  if ($form.length < 1) {\n    return;\n  }\n\n  const $submitButton = $form.find(\"button[type='submit']\");\n  if ($selectedItems.children().length === 0) {\n    $submitButton.prop(\"disabled\", true);\n  } else {\n    $submitButton.prop(\"disabled\", false);\n  }\n}\n\n$(() => {\n  const $fieldContainer = $(\".multiple-mentions\");\n  if ($fieldContainer.length < 1) {\n    return;\n  }\n\n  const allMessages = window.Decidim.config.get(\"messages\");\n  const messages = allMessages.mentionsModal || {};\n\n  const $searchInput = $(\"input\", $fieldContainer);\n  const $selectedItems = $(`ul.${$searchInput.data().selected}`);\n  const options = $fieldContainer.data();\n  let selected = [];\n  const iconsPath = window.Decidim.config.get(\"icons_path\");\n  const removeLabel = messages.removeRecipient || \"Remove recipient %name%\";\n\n  let emptyFocusElement = $fieldContainer[0].querySelector(\".empty-list\");\n  if (!emptyFocusElement) {\n    emptyFocusElement = document.createElement(\"div\");\n    emptyFocusElement.tabIndex = \"-1\";\n    emptyFocusElement.className = \"empty-list\";\n    $selectedItems.before(emptyFocusElement);\n  }\n\n  updateSubmitButton($fieldContainer, $selectedItems);\n  const autoComplete = new AutoComplete($searchInput[0], {\n    dataMatchKeys: [\"name\", \"nickname\"],\n    dataSource: (query, callback) => {\n      $.post(\"/api\", {\n        \"query\": `\n          {\n            users(filter:{wildcard:\"${query}\",excludeIds:[]})\n              {\n                id,nickname,name,avatarUrl,__typename,...on UserGroup{membersCount},...on User{\n                  directMessagesEnabled\n                }\n              }\n          }`\n      }).then((response) => {\n        callback(response.data.users);\n      });\n    },\n    dataFilter: (list) => {\n      return list.filter(\n        (item) => !selected.includes(item.value.id)\n      );\n    },\n    modifyResult: (element, value) => {\n      $(element).html(`\n        <span class=\"author__avatar\"><img src=\"${value.avatarUrl}\" alt=\"${value.name}\"></span>\n        <strong>${value.nickname}</strong>\n        <small>${value.name}</small>\n      `);\n      if (value.directMessagesEnabled === \"false\") {\n        $(element).addClass(\"disabled\");\n        $(element).append(`<span>${$searchInput.data().directMessagesDisabled}</span>`);\n      }\n      if (value.membersCount) {\n        $(element).append(`<span class=\"is-group\">${value.membersCount}x <svg class=\"icon--members icon\"><use href=\"${iconsPath}#icon-members\"/></svg></span>`);\n      }\n    }\n  });\n\n  $searchInput.on(\"selection\", (event) => {\n    const feedback = event.detail;\n    const selection = feedback.selection;\n    const id = selection.value.id;\n    if (selected.length >= 9 || selection.value.directMessagesEnabled === \"false\") {\n      return;\n    }\n\n    const label = removeLabel.replace(\"%name%\", selection.value.name);\n    $selectedItems.append(`\n      <li tabindex=\"-1\">\n        <input type=\"hidden\" name=\"${options.name}\" value=\"${id}\">\n        <img src=\"${selection.value.avatarUrl}\" class=\"author__avatar\" alt=\"${selection.value.name}\">\n        <b>${selection.value.name}</b>\n        <button type=\"button\" class=\"float-right\" data-remove=\"${id}\" tabindex=\"0\" aria-controls=\"0\" aria-label=\"${label}\">&times;</button>\n      </li>\n    `);\n\n    autoComplete.setInput(\"\");\n    selected.push(id);\n    updateSubmitButton($fieldContainer, $selectedItems);\n\n    $selectedItems.find(`*[data-remove=\"${id}\"]`).on(\"keypress click\", (evt) => {\n      const target = evt.target.parentNode;\n      if (target.tagName === \"LI\") {\n        const focusElement = target.nextElementSibling || target.previousElementSibling || emptyFocusElement;\n\n        selected = selected.filter((identifier) => identifier !== id);\n        target.remove();\n\n        updateSubmitButton($fieldContainer, $selectedItems);\n        focusElement.focus();\n      }\n    })\n  })\n})\n"]},"metadata":{},"sourceType":"module"}