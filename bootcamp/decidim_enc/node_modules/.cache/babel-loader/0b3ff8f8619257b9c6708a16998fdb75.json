{"ast":null,"code":"/* eslint-disable require-jsdoc, id-length, no-undefined, no-unused-vars, multiline-ternary, no-ternary, no-nested-ternary, no-invalid-this */\n/* eslint prefer-reflect: [\"error\", { \"exceptions\": [\"call\"] }] */\n/* eslint dot-location: [\"error\", \"property\"] */\n/* eslint no-unused-vars: 0 */\n\nimport { select, mouse } from \"d3-selection\";\nimport { min, max, extent, ascending, bisector } from \"d3-array\";\nimport { scaleTime, scaleLinear } from \"d3-scale\";\nimport { axisLeft, axisBottom } from \"d3-axis\";\nimport { timeMonth } from \"d3-time\";\nimport { timeFormat, isoParse } from \"d3-time-format\";\nimport { area, line } from \"d3-shape\";\n\n// lib\nexport default function areachart() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var parseData = function parseData(data) {\n    // format the data\n    data.forEach(function (d) {\n      d.key = isoParse(d.key);\n      d.value = Number(d.value);\n    });\n\n    // order by date\n    return data.sort(function (x, y) {\n      return ascending(x.key, y.key);\n    });\n  };\n\n  // OPTIONAL: Helper function to accumulates all data values\n  var aggregate = function aggregate(agg) {\n    return agg.map(function (item, index, array) {\n      if (index > 0) {\n        item.value += array[index - 1].value;\n      }\n      return item;\n    });\n  };\n\n  // parse opts\n  var data = parseData(opts.data);\n  var title = opts.title;\n  var objectName = opts.objectName || \"\";\n  var container = select(opts.container);\n  var showAxis = opts.axis || false;\n  var ratio = (opts.ratio || \"\").split(\":\").reduce(function (a, b) {\n    return a / b;\n  }) || 4 / 3;\n  var showTooltip = Object.is(opts.tip, undefined) ? true : opts.tip;\n  var cumulative = opts.agg || false;\n  if (cumulative) {\n    data = aggregate(data);\n  }\n\n  // set the dimensions and margins of the graph\n  var margin = {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n  var width = Number(container.node().getBoundingClientRect().width) - margin.left - margin.right;\n  var height = width / ratio - margin.top - margin.bottom;\n  var titlePadding = min([width / 10, 32]);\n\n  // set the ranges\n  var x = scaleTime().range([0, width]);\n  var y = scaleLinear().range([height, 0]);\n\n  // define the area\n  var _area = area().x(function (d) {\n    return x(d.key);\n  }).y0(height).y1(function (d) {\n    return y(d.value);\n  });\n\n  // define the line\n  var valueline = line().x(function (d) {\n    return x(d.key);\n  }).y(function (d) {\n    return y(d.value);\n  });\n  var svg = container.append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\".concat(margin.left, \",\").concat(margin.top, \")\"));\n\n  // scale the range of the data\n  x.domain(extent(data, function (d) {\n    return d.key;\n  }));\n  y.domain([0, max(data, function (d) {\n    return d.value;\n  })]).nice();\n\n  // add the valueline path.\n  var topLine = svg.append(\"path\").data([data]).attr(\"class\", \"line\").attr(\"d\", valueline);\n\n  // add the area\n  svg.append(\"path\").data([data]).attr(\"class\", \"area\").attr(\"d\", _area);\n  if (showTooltip) {\n    // tooltip\n    var circle = svg.append(\"circle\").attr(\"class\", \"circle\").attr(\"r\", 6).style(\"display\", \"none\");\n    var tooltip = select(\"body\").append(\"div\").attr(\"id\", \"\".concat(container.node().id, \"-tooltip\")).attr(\"class\", \"chart-tooltip\").style(\"opacity\", 0);\n    svg.on(\"mouseover\", function () {\n      circle.style(\"display\", null);\n      tooltip.style(\"opacity\", 1);\n    }).on(\"mouseout\", function () {\n      circle.style(\"display\", \"none\");\n      tooltip.style(\"opacity\", 0);\n    }).on(\"mousemove\", function () {\n      var x0 = x.invert(mouse(this)[0]);\n      var i = bisector(function (d) {\n        return d.key;\n      }).left(data, x0, 1);\n      var d0 = data[i - 1];\n      var d1 = data[i];\n      var d = x0 - d0.key > d1.key - x0 ? d1 : d0;\n\n      // svg position relative to document\n      var coords = {\n        x: window.pageXOffset + container.node().getBoundingClientRect().left,\n        y: window.pageYOffset + container.node().getBoundingClientRect().top\n      };\n      var tooltipContent = \"\\n          <div class=\\\"tooltip-content\\\">\\n            \".concat(timeFormat(\"%e %B %Y\")(d.key), \"<br />\\n            \").concat(d.value.toLocaleString(), \" \").concat(objectName, \"\\n          </div>\");\n      circle.attr(\"transform\", \"translate(\".concat(x(d.key), \",\").concat(y(d.value), \")\"));\n      tooltip.html(tooltipContent).style(\"left\", \"\".concat(coords.x + x(d.key), \"px\")).style(\"top\", \"\".concat(coords.y + y(d.value), \"px\"));\n    });\n  }\n  if (showAxis) {\n    var xAxis = axisBottom(x).ticks(timeMonth).tickFormat(timeFormat(\"%b %y\")).tickSize(-height);\n    var yAxis = axisLeft(y).ticks(5).tickSize(8);\n    var _xAxis = function _xAxis(g) {\n      g.call(xAxis);\n      g.select(\".domain\").remove();\n      g.selectAll(\".tick line\").attr(\"class\", \"dashed\");\n      g.selectAll(\".tick text\").attr(\"y\", 6);\n    };\n    var _yAxis = function _yAxis(g) {\n      g.call(yAxis);\n      g.select(\".domain\").remove();\n      g.select(\".tick:first-of-type\").remove();\n      g.selectAll(\".tick text\").attr(\"text-anchor\", \"start\").attr(\"x\", 6);\n    };\n\n    // custom X-Axis\n    svg.append(\"g\").attr(\"transform\", \"translate(0,\".concat(height, \")\")).call(_xAxis);\n\n    // custom Y-Axis\n    svg.append(\"g\").call(_yAxis);\n\n    // last circle (current value)\n    var g = svg.append(\"g\").data([data]).attr(\"transform\", function (d) {\n      return \"translate(\".concat(x(d[d.length - 1].key), \",\").concat(y(d[d.length - 1].value), \")\");\n    });\n    g.append(\"circle\").attr(\"class\", \"circle\").attr(\"r\", 8);\n    g.append(\"text\").attr(\"class\", \"sum\").attr(\"text-anchor\", \"end\").attr(\"dx\", -8 * 2).text(function (d) {\n      return d[d.length - 1].value.toLocaleString();\n    });\n  } else {\n    // add the title group\n    var _g = svg.append(\"g\").attr(\"text-anchor\", \"start\").attr(\"transform\", \"translate(\".concat(titlePadding, \",\").concat(titlePadding, \")\"));\n    var titleLines = 0;\n    if (title.length) {\n      _g.append(\"text\").attr(\"x\", 0).attr(\"y\", 0).attr(\"class\", \"title\").text(title).call(function (fulltext, wrapwidth) {\n        var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n        fulltext.each(function () {\n          var text = select(this);\n          var word = \"\";\n          var words = text.text().split(/\\s+/).reverse();\n          var _line = [];\n          var lineNumber = 0;\n          var lineHeight = 1.1;\n          var _x = text.attr(\"x\");\n          var _y = text.attr(\"y\");\n          var dy = 0;\n          var tspan = text.text(null).append(\"tspan\").attr(\"x\", _x).attr(\"y\", _y).attr(\"dy\", \"\".concat(dy, \"em\"));\n\n          /* eslint-disable no-cond-assign, no-plusplus */\n          while (word = words.pop()) {\n            _line.push(word);\n            tspan.text(_line.join(\" \"));\n            if (tspan.node().getComputedTextLength() > wrapwidth) {\n              _line.pop();\n              tspan.text(_line.join(\" \"));\n              _line = [word];\n              tspan = text.append(\"tspan\").attr(\"x\", _x).attr(\"y\", _y).attr(\"dy\", \"\".concat(++lineNumber * lineHeight + dy, \"em\")).text(word);\n            }\n          }\n          titleLines = lineNumber * lineHeight;\n        });\n      }, width - titlePadding * 2);\n    }\n    var fontSize = parseFloat(getComputedStyle(_g.node()).fontSize);\n    _g.append(\"text\").attr(\"x\", 0).attr(\"dy\", title.length ? titlePadding * 2 + titleLines * fontSize : titlePadding * 1.25).attr(\"class\", \"sum\").text(data[data.length - 1].value.toLocaleString());\n  }\n}","map":{"version":3,"mappings":"AAAA;AACA;AACA;AACA;;AAEA,SAASA,MAAM,EAAEC,KAAK,QAAQ,cAAc;AAC5C,SAASC,GAAG,EAAEC,GAAG,EAAEC,MAAM,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,UAAU;AAChE,SAASC,SAAS,EAAEC,WAAW,QAAQ,UAAU;AACjD,SAASC,QAAQ,EAAEC,UAAU,QAAQ,SAAS;AAC9C,SAASC,SAAS,QAAQ,SAAS;AACnC,SAASC,UAAU,EAAEC,QAAQ,QAAQ,gBAAgB;AACrD,SAASC,IAAI,EAAEC,IAAI,QAAQ,UAAU;;AAErC;AACA,eAAe,SAASC,SAAS,GAAY;EAAA,IAAXC,IAAI,uEAAG,CAAC,CAAC;EAEzC,IAAMC,SAAS,GAAG,SAAZA,SAAS,CAAIC,IAAI,EAAK;IAC1B;IACAA,IAAI,CAACC,OAAO,CAAC,UAACC,CAAC,EAAK;MAClBA,CAAC,CAACC,GAAG,GAAGT,QAAQ,CAACQ,CAAC,CAACC,GAAG,CAAC;MACvBD,CAAC,CAACE,KAAK,GAAGC,MAAM,CAACH,CAAC,CAACE,KAAK,CAAC;IAC3B,CAAC,CAAC;;IAEF;IACA,OAAOJ,IAAI,CAACM,IAAI,CAAC,UAACC,CAAC,EAAEC,CAAC;MAAA,OAAKtB,SAAS,CAACqB,CAAC,CAACJ,GAAG,EAAEK,CAAC,CAACL,GAAG,CAAC;IAAA,EAAC;EACrD,CAAC;;EAED;EACA,IAAMM,SAAS,GAAG,SAAZA,SAAS,CAAIC,GAAG;IAAA,OAAKA,GAAG,CAACC,GAAG,CAAC,UAACC,IAAI,EAAEC,KAAK,EAAEC,KAAK,EAAK;MACzD,IAAID,KAAK,GAAG,CAAC,EAAE;QACbD,IAAI,CAACR,KAAK,IAAIU,KAAK,CAACD,KAAK,GAAG,CAAC,CAAC,CAACT,KAAK;MACtC;MACA,OAAOQ,IAAI;IACb,CAAC,CAAC;EAAA;;EAEF;EACA,IAAIZ,IAAI,GAAGD,SAAS,CAACD,IAAI,CAACE,IAAI,CAAC;EAC/B,IAAIe,KAAK,GAAGjB,IAAI,CAACiB,KAAK;EACtB,IAAIC,UAAU,GAAGlB,IAAI,CAACkB,UAAU,IAAI,EAAE;EACtC,IAAIC,SAAS,GAAGpC,MAAM,CAACiB,IAAI,CAACmB,SAAS,CAAC;EACtC,IAAIC,QAAQ,GAAGpB,IAAI,CAACqB,IAAI,IAAI,KAAK;EACjC,IAAIC,KAAK,GAAG,CAACtB,IAAI,CAACsB,KAAK,IAAI,EAAE,EAAEC,KAAK,CAAC,GAAG,CAAC,CAACC,MAAM,CAAC,UAACC,CAAC,EAAEC,CAAC;IAAA,OAAKD,CAAC,GAAGC,CAAC;EAAA,EAAC,IAAK,CAAC,GAAG,CAAE;EAC5E,IAAIC,WAAW,GAAGC,MAAM,CAACC,EAAE,CAAC7B,IAAI,CAAC8B,GAAG,EAAEC,SAAS,CAAC,GAAG,IAAI,GAAG/B,IAAI,CAAC8B,GAAG;EAClE,IAAIE,UAAU,GAAGhC,IAAI,CAACY,GAAG,IAAI,KAAK;EAElC,IAAIoB,UAAU,EAAE;IACd9B,IAAI,GAAGS,SAAS,CAACT,IAAI,CAAC;EACxB;;EAEA;EACA,IAAI+B,MAAM,GAAG;IACXC,GAAG,EAAE,CAAC;IACNC,KAAK,EAAE,CAAC;IACRC,MAAM,EAAE,CAAC;IACTC,IAAI,EAAE;EACR,CAAC;EAED,IAAIC,KAAK,GAAG/B,MAAM,CAACY,SAAS,CAACoB,IAAI,EAAE,CAACC,qBAAqB,EAAE,CAACF,KAAK,CAAC,GAAGL,MAAM,CAACI,IAAI,GAAGJ,MAAM,CAACE,KAAK;EAC/F,IAAIM,MAAM,GAAIH,KAAK,GAAGhB,KAAK,GAAIW,MAAM,CAACC,GAAG,GAAGD,MAAM,CAACG,MAAM;EACzD,IAAIM,YAAY,GAAGzD,GAAG,CAAC,CAACqD,KAAK,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC;;EAExC;EACA,IAAI7B,CAAC,GAAGnB,SAAS,EAAE,CAACqD,KAAK,CAAC,CAAC,CAAC,EAAEL,KAAK,CAAC,CAAC;EACrC,IAAI5B,CAAC,GAAGnB,WAAW,EAAE,CAACoD,KAAK,CAAC,CAACF,MAAM,EAAE,CAAC,CAAC,CAAC;;EAExC;EACA,IAAIG,KAAK,GAAG/C,IAAI,EAAE,CACfY,CAAC,CAAC,UAACL,CAAC;IAAA,OAAKK,CAAC,CAACL,CAAC,CAACC,GAAG,CAAC;EAAA,EAAC,CAClBwC,EAAE,CAACJ,MAAM,CAAC,CACVK,EAAE,CAAC,UAAC1C,CAAC;IAAA,OAAKM,CAAC,CAACN,CAAC,CAACE,KAAK,CAAC;EAAA,EAAC;;EAExB;EACA,IAAIyC,SAAS,GAAGjD,IAAI,EAAE,CACnBW,CAAC,CAAC,UAACL,CAAC;IAAA,OAAKK,CAAC,CAACL,CAAC,CAACC,GAAG,CAAC;EAAA,EAAC,CAClBK,CAAC,CAAC,UAACN,CAAC;IAAA,OAAKM,CAAC,CAACN,CAAC,CAACE,KAAK,CAAC;EAAA,EAAC;EAEvB,IAAI0C,GAAG,GAAG7B,SAAS,CAAC8B,MAAM,CAAC,KAAK,CAAC,CAC9BC,IAAI,CAAC,OAAO,EAAEZ,KAAK,GAAGL,MAAM,CAACI,IAAI,GAAGJ,MAAM,CAACE,KAAK,CAAC,CACjDe,IAAI,CAAC,QAAQ,EAAET,MAAM,GAAGR,MAAM,CAACC,GAAG,GAAGD,MAAM,CAACG,MAAM,CAAC,CACnDa,MAAM,CAAC,GAAG,CAAC,CACXC,IAAI,CAAC,WAAW,sBAAejB,MAAM,CAACI,IAAI,cAAIJ,MAAM,CAACC,GAAG,OAAI;;EAE/D;EACAzB,CAAC,CAAC0C,MAAM,CAAChE,MAAM,CAACe,IAAI,EAAE,UAACE,CAAC;IAAA,OAAKA,CAAC,CAACC,GAAG;EAAA,EAAC,CAAC;EACpCK,CAAC,CAACyC,MAAM,CAAC,CAAC,CAAC,EAAEjE,GAAG,CAACgB,IAAI,EAAE,UAACE,CAAC;IAAA,OAAKA,CAAC,CAACE,KAAK;EAAA,EAAC,CAAC,CAAC,CAAC8C,IAAI,EAAE;;EAE/C;EACA,IAAIC,OAAO,GAAGL,GAAG,CAACC,MAAM,CAAC,MAAM,CAAC,CAC7B/C,IAAI,CAAC,CAACA,IAAI,CAAC,CAAC,CACZgD,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CACrBA,IAAI,CAAC,GAAG,EAAEH,SAAS,CAAC;;EAEvB;EACAC,GAAG,CAACC,MAAM,CAAC,MAAM,CAAC,CACf/C,IAAI,CAAC,CAACA,IAAI,CAAC,CAAC,CACZgD,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CACrBA,IAAI,CAAC,GAAG,EAAEN,KAAK,CAAC;EAEnB,IAAIjB,WAAW,EAAE;IACf;IACA,IAAI2B,MAAM,GAAGN,GAAG,CAACC,MAAM,CAAC,QAAQ,CAAC,CAC9BC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CACvBA,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CACZK,KAAK,CAAC,SAAS,EAAE,MAAM,CAAC;IAE3B,IAAIC,OAAO,GAAGzE,MAAM,CAAC,MAAM,CAAC,CAACkE,MAAM,CAAC,KAAK,CAAC,CACvCC,IAAI,CAAC,IAAI,YAAK/B,SAAS,CAACoB,IAAI,EAAE,CAACkB,EAAE,cAAW,CAC5CP,IAAI,CAAC,OAAO,EAAE,eAAe,CAAC,CAC9BK,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;IAEtBP,GAAG,CACAU,EAAE,CAAC,WAAW,EAAE,YAAM;MACrBJ,MAAM,CAACC,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC;MAC7BC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;IAC7B,CAAC,CAAC,CACDG,EAAE,CAAC,UAAU,EAAE,YAAM;MACpBJ,MAAM,CAACC,KAAK,CAAC,SAAS,EAAE,MAAM,CAAC;MAC/BC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;IAC7B,CAAC,CAAC,CACDG,EAAE,CAAC,WAAW,EAAE,YAAW;MAC1B,IAAIC,EAAE,GAAGlD,CAAC,CAACmD,MAAM,CAAC5E,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;MACjC,IAAI6E,CAAC,GAAGxE,QAAQ,CAAC,UAACe,CAAC;QAAA,OAAKA,CAAC,CAACC,GAAG;MAAA,EAAC,CAACgC,IAAI,CAACnC,IAAI,EAAEyD,EAAE,EAAE,CAAC,CAAC;MAChD,IAAIG,EAAE,GAAG5D,IAAI,CAAC2D,CAAC,GAAG,CAAC,CAAC;MACpB,IAAIE,EAAE,GAAG7D,IAAI,CAAC2D,CAAC,CAAC;MAChB,IAAIzD,CAAC,GAAIuD,EAAE,GAAGG,EAAE,CAACzD,GAAG,GAAG0D,EAAE,CAAC1D,GAAG,GAAGsD,EAAE,GAAII,EAAE,GAAGD,EAAE;;MAE7C;MACA,IAAIE,MAAM,GAAG;QACXvD,CAAC,EAAEwD,MAAM,CAACC,WAAW,GAAG/C,SAAS,CAACoB,IAAI,EAAE,CAACC,qBAAqB,EAAE,CAACH,IAAI;QACrE3B,CAAC,EAAEuD,MAAM,CAACE,WAAW,GAAGhD,SAAS,CAACoB,IAAI,EAAE,CAACC,qBAAqB,EAAE,CAACN;MACnE,CAAC;MAED,IAAIkC,cAAc,sEAEZzE,UAAU,CAAC,UAAU,CAAC,CAACS,CAAC,CAACC,GAAG,CAAC,iCAC7BD,CAAC,CAACE,KAAK,CAAC+D,cAAc,EAAE,cAAInD,UAAU,uBACnC;MAEToC,MAAM,CAACJ,IAAI,CAAC,WAAW,sBAAezC,CAAC,CAACL,CAAC,CAACC,GAAG,CAAC,cAAIK,CAAC,CAACN,CAAC,CAACE,KAAK,CAAC,OAAI;MAChEkD,OAAO,CAACc,IAAI,CAACF,cAAc,CAAC,CACzBb,KAAK,CAAC,MAAM,YAAKS,MAAM,CAACvD,CAAC,GAAGA,CAAC,CAACL,CAAC,CAACC,GAAG,CAAC,QAAK,CACzCkD,KAAK,CAAC,KAAK,YAAKS,MAAM,CAACtD,CAAC,GAAGA,CAAC,CAACN,CAAC,CAACE,KAAK,CAAC,QAAK;IAC/C,CAAC,CAAC;EACN;EAEA,IAAIc,QAAQ,EAAE;IACZ,IAAImD,KAAK,GAAG9E,UAAU,CAACgB,CAAC,CAAC,CACtB+D,KAAK,CAAC9E,SAAS,CAAC,CAChB+E,UAAU,CAAC9E,UAAU,CAAC,OAAO,CAAC,CAAC,CAC/B+E,QAAQ,CAAC,CAACjC,MAAM,CAAC;IACpB,IAAIkC,KAAK,GAAGnF,QAAQ,CAACkB,CAAC,CAAC,CACpB8D,KAAK,CAAC,CAAC,CAAC,CACRE,QAAQ,CAAC,CAAC,CAAC;IAEd,IAAIE,MAAM,GAAG,SAATA,MAAM,CAAIC,CAAC,EAAK;MAClBA,CAAC,CAACC,IAAI,CAACP,KAAK,CAAC;MACbM,CAAC,CAAC9F,MAAM,CAAC,SAAS,CAAC,CAACgG,MAAM,EAAE;MAC5BF,CAAC,CAACG,SAAS,CAAC,YAAY,CAAC,CAAC9B,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC;MACjD2B,CAAC,CAACG,SAAS,CAAC,YAAY,CAAC,CAAC9B,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;IACxC,CAAC;IACD,IAAI+B,MAAM,GAAG,SAATA,MAAM,CAAIJ,CAAC,EAAK;MAClBA,CAAC,CAACC,IAAI,CAACH,KAAK,CAAC;MACbE,CAAC,CAAC9F,MAAM,CAAC,SAAS,CAAC,CAACgG,MAAM,EAAE;MAC5BF,CAAC,CAAC9F,MAAM,CAAC,qBAAqB,CAAC,CAACgG,MAAM,EAAE;MACxCF,CAAC,CAACG,SAAS,CAAC,YAAY,CAAC,CAAC9B,IAAI,CAAC,aAAa,EAAE,OAAO,CAAC,CAACA,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;IACrE,CAAC;;IAED;IACAF,GAAG,CAACC,MAAM,CAAC,GAAG,CAAC,CACZC,IAAI,CAAC,WAAW,wBAAiBT,MAAM,OAAI,CAC3CqC,IAAI,CAACF,MAAM,CAAC;;IAEf;IACA5B,GAAG,CAACC,MAAM,CAAC,GAAG,CAAC,CACZ6B,IAAI,CAACG,MAAM,CAAC;;IAEf;IACA,IAAIJ,CAAC,GAAG7B,GAAG,CAACC,MAAM,CAAC,GAAG,CAAC,CACpB/C,IAAI,CAAC,CAACA,IAAI,CAAC,CAAC,CACZgD,IAAI,CAAC,WAAW,EAAE,UAAC9C,CAAC;MAAA,2BAAkBK,CAAC,CAACL,CAAC,CAACA,CAAC,CAAC8E,MAAM,GAAG,CAAC,CAAC,CAAC7E,GAAG,CAAC,cAAIK,CAAC,CAACN,CAAC,CAACA,CAAC,CAAC8E,MAAM,GAAG,CAAC,CAAC,CAAC5E,KAAK,CAAC;IAAA,CAAG,CAAC;IAE/FuE,CAAC,CAAC5B,MAAM,CAAC,QAAQ,CAAC,CACfC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CACvBA,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;IAEf2B,CAAC,CAAC5B,MAAM,CAAC,MAAM,CAAC,CACbC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CACpBA,IAAI,CAAC,aAAa,EAAE,KAAK,CAAC,CAC1BA,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAClBiC,IAAI,CAAC,UAAC/E,CAAC;MAAA,OAAKA,CAAC,CAACA,CAAC,CAAC8E,MAAM,GAAG,CAAC,CAAC,CAAC5E,KAAK,CAAC+D,cAAc,EAAE;IAAA,EAAC;EAExD,CAAC,MAAM;IACL;IACA,IAAIQ,EAAC,GAAG7B,GAAG,CAACC,MAAM,CAAC,GAAG,CAAC,CACpBC,IAAI,CAAC,aAAa,EAAE,OAAO,CAAC,CAC5BA,IAAI,CAAC,WAAW,sBAAeR,YAAY,cAAIA,YAAY,OAAI;IAElE,IAAI0C,UAAU,GAAG,CAAC;IAElB,IAAInE,KAAK,CAACiE,MAAM,EAAE;MAChBL,EAAC,CAAC5B,MAAM,CAAC,MAAM,CAAC,CACbC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CACZA,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CACZA,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,CACtBiC,IAAI,CAAClE,KAAK,CAAC,CACX6D,IAAI,CAAC,UAASO,QAAQ,EAAEC,SAAS,EAAa;QAAA,IAAXC,KAAK,uEAAG,CAAC;QAC3CF,QAAQ,CAACG,IAAI,CAAC,YAAW;UACvB,IAAIL,IAAI,GAAGpG,MAAM,CAAC,IAAI,CAAC;UACvB,IAAI0G,IAAI,GAAG,EAAE;UACb,IAAIC,KAAK,GAAGP,IAAI,CAACA,IAAI,EAAE,CAAC5D,KAAK,CAAC,KAAK,CAAC,CAACoE,OAAO,EAAE;UAC9C,IAAIC,KAAK,GAAG,EAAE;UACd,IAAIC,UAAU,GAAG,CAAC;UAClB,IAAIC,UAAU,GAAG,GAAG;UACpB,IAAIC,EAAE,GAAGZ,IAAI,CAACjC,IAAI,CAAC,GAAG,CAAC;UACvB,IAAI8C,EAAE,GAAGb,IAAI,CAACjC,IAAI,CAAC,GAAG,CAAC;UACvB,IAAI+C,EAAE,GAAG,CAAC;UACV,IAAIC,KAAK,GAAGf,IAAI,CAACA,IAAI,CAAC,IAAI,CAAC,CACxBlC,MAAM,CAAC,OAAO,CAAC,CACfC,IAAI,CAAC,GAAG,EAAE6C,EAAE,CAAC,CACb7C,IAAI,CAAC,GAAG,EAAE8C,EAAE,CAAC,CACb9C,IAAI,CAAC,IAAI,YAAK+C,EAAE,QAAK;;UAExB;UACA,OAAOR,IAAI,GAAGC,KAAK,CAACS,GAAG,EAAE,EAAE;YACzBP,KAAK,CAACQ,IAAI,CAACX,IAAI,CAAC;YAChBS,KAAK,CAACf,IAAI,CAACS,KAAK,CAACS,IAAI,CAAC,GAAG,CAAC,CAAC;YAC3B,IAAIH,KAAK,CAAC3D,IAAI,EAAE,CAAC+D,qBAAqB,EAAE,GAAGhB,SAAS,EAAE;cACpDM,KAAK,CAACO,GAAG,EAAE;cACXD,KAAK,CAACf,IAAI,CAACS,KAAK,CAACS,IAAI,CAAC,GAAG,CAAC,CAAC;cAC3BT,KAAK,GAAG,CAACH,IAAI,CAAC;cACdS,KAAK,GAAGf,IAAI,CAAClC,MAAM,CAAC,OAAO,CAAC,CACzBC,IAAI,CAAC,GAAG,EAAE6C,EAAE,CAAC,CACb7C,IAAI,CAAC,GAAG,EAAE8C,EAAE,CAAC,CACb9C,IAAI,CAAC,IAAI,YAAM,EAAE2C,UAAU,GAAGC,UAAU,GAAIG,EAAE,QAAK,CACnDd,IAAI,CAACM,IAAI,CAAC;YACf;UACF;UAEAL,UAAU,GAAGS,UAAU,GAAGC,UAAU;QACtC,CAAC,CAAC;MACJ,CAAC,EAAExD,KAAK,GAAII,YAAY,GAAG,CAAE,CAAC;IAClC;IAEA,IAAI6D,QAAQ,GAAGC,UAAU,CAACC,gBAAgB,CAAC5B,EAAC,CAACtC,IAAI,EAAE,CAAC,CAACgE,QAAQ,CAAC;IAE9D1B,EAAC,CAAC5B,MAAM,CAAC,MAAM,CAAC,CACbC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CACZA,IAAI,CAAC,IAAI,EAAEjC,KAAK,CAACiE,MAAM,GAAIxC,YAAY,GAAG,CAAC,GAAK0C,UAAU,GAAGmB,QAAS,GAAI7D,YAAY,GAAG,IAAK,CAAC,CAC/FQ,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CACpBiC,IAAI,CAACjF,IAAI,CAACA,IAAI,CAACgF,MAAM,GAAG,CAAC,CAAC,CAAC5E,KAAK,CAAC+D,cAAc,EAAE,CAAC;EACvD;AACF","names":["select","mouse","min","max","extent","ascending","bisector","scaleTime","scaleLinear","axisLeft","axisBottom","timeMonth","timeFormat","isoParse","area","line","areachart","opts","parseData","data","forEach","d","key","value","Number","sort","x","y","aggregate","agg","map","item","index","array","title","objectName","container","showAxis","axis","ratio","split","reduce","a","b","showTooltip","Object","is","tip","undefined","cumulative","margin","top","right","bottom","left","width","node","getBoundingClientRect","height","titlePadding","range","_area","y0","y1","valueline","svg","append","attr","domain","nice","topLine","circle","style","tooltip","id","on","x0","invert","i","d0","d1","coords","window","pageXOffset","pageYOffset","tooltipContent","toLocaleString","html","xAxis","ticks","tickFormat","tickSize","yAxis","_xAxis","g","call","remove","selectAll","_yAxis","length","text","titleLines","fulltext","wrapwidth","start","each","word","words","reverse","_line","lineNumber","lineHeight","_x","_y","dy","tspan","pop","push","join","getComputedTextLength","fontSize","parseFloat","getComputedStyle"],"sources":["/home/alan/.rvm/gems/ruby-3.0.3/gems/decidim-core-0.27.0/app/packs/src/decidim/vizzs/areachart.js"],"sourcesContent":["/* eslint-disable require-jsdoc, id-length, no-undefined, no-unused-vars, multiline-ternary, no-ternary, no-nested-ternary, no-invalid-this */\n/* eslint prefer-reflect: [\"error\", { \"exceptions\": [\"call\"] }] */\n/* eslint dot-location: [\"error\", \"property\"] */\n/* eslint no-unused-vars: 0 */\n\nimport { select, mouse } from \"d3-selection\";\nimport { min, max, extent, ascending, bisector } from \"d3-array\";\nimport { scaleTime, scaleLinear } from \"d3-scale\";\nimport { axisLeft, axisBottom } from \"d3-axis\";\nimport { timeMonth } from \"d3-time\";\nimport { timeFormat, isoParse } from \"d3-time-format\";\nimport { area, line } from \"d3-shape\";\n\n// lib\nexport default function areachart(opts = {}) {\n\n  const parseData = (data) => {\n    // format the data\n    data.forEach((d) => {\n      d.key = isoParse(d.key)\n      d.value = Number(d.value)\n    });\n\n    // order by date\n    return data.sort((x, y) => ascending(x.key, y.key))\n  }\n\n  // OPTIONAL: Helper function to accumulates all data values\n  const aggregate = (agg) => agg.map((item, index, array) => {\n    if (index > 0) {\n      item.value += array[index - 1].value\n    }\n    return item\n  })\n\n  // parse opts\n  let data = parseData(opts.data)\n  let title = opts.title\n  let objectName = opts.objectName || \"\"\n  let container = select(opts.container)\n  let showAxis = opts.axis || false\n  let ratio = (opts.ratio || \"\").split(\":\").reduce((a, b) => a / b) || (4 / 3)\n  let showTooltip = Object.is(opts.tip, undefined) ? true : opts.tip\n  let cumulative = opts.agg || false\n\n  if (cumulative) {\n    data = aggregate(data)\n  }\n\n  // set the dimensions and margins of the graph\n  let margin = {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  }\n\n  let width = Number(container.node().getBoundingClientRect().width) - margin.left - margin.right\n  let height = (width / ratio) - margin.top - margin.bottom\n  let titlePadding = min([width / 10, 32])\n\n  // set the ranges\n  let x = scaleTime().range([0, width]);\n  let y = scaleLinear().range([height, 0]);\n\n  // define the area\n  let _area = area()\n    .x((d) => x(d.key))\n    .y0(height)\n    .y1((d) => y(d.value));\n\n  // define the line\n  let valueline = line()\n    .x((d) => x(d.key))\n    .y((d) => y(d.value));\n\n  let svg = container.append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\n  // scale the range of the data\n  x.domain(extent(data, (d) => d.key));\n  y.domain([0, max(data, (d) => d.value)]).nice();\n\n  // add the valueline path.\n  let topLine = svg.append(\"path\")\n    .data([data])\n    .attr(\"class\", \"line\")\n    .attr(\"d\", valueline)\n\n  // add the area\n  svg.append(\"path\")\n    .data([data])\n    .attr(\"class\", \"area\")\n    .attr(\"d\", _area)\n\n  if (showTooltip) {\n    // tooltip\n    let circle = svg.append(\"circle\")\n      .attr(\"class\", \"circle\")\n      .attr(\"r\", 6)\n      .style(\"display\", \"none\")\n\n    let tooltip = select(\"body\").append(\"div\")\n      .attr(\"id\", `${container.node().id}-tooltip`)\n      .attr(\"class\", \"chart-tooltip\")\n      .style(\"opacity\", 0)\n\n    svg\n      .on(\"mouseover\", () => {\n        circle.style(\"display\", null)\n        tooltip.style(\"opacity\", 1)\n      })\n      .on(\"mouseout\", () => {\n        circle.style(\"display\", \"none\")\n        tooltip.style(\"opacity\", 0)\n      })\n      .on(\"mousemove\", function() {\n        let x0 = x.invert(mouse(this)[0])\n        let i = bisector((d) => d.key).left(data, x0, 1)\n        let d0 = data[i - 1]\n        let d1 = data[i]\n        let d = (x0 - d0.key > d1.key - x0) ? d1 : d0\n\n        // svg position relative to document\n        let coords = {\n          x: window.pageXOffset + container.node().getBoundingClientRect().left,\n          y: window.pageYOffset + container.node().getBoundingClientRect().top\n        }\n\n        let tooltipContent = `\n          <div class=\"tooltip-content\">\n            ${timeFormat(\"%e %B %Y\")(d.key)}<br />\n            ${d.value.toLocaleString()} ${objectName}\n          </div>`\n\n        circle.attr(\"transform\", `translate(${x(d.key)},${y(d.value)})`)\n        tooltip.html(tooltipContent)\n          .style(\"left\", `${coords.x + x(d.key)}px`)\n          .style(\"top\", `${coords.y + y(d.value)}px`)\n      })\n  }\n\n  if (showAxis) {\n    let xAxis = axisBottom(x)\n      .ticks(timeMonth)\n      .tickFormat(timeFormat(\"%b %y\"))\n      .tickSize(-height)\n    let yAxis = axisLeft(y)\n      .ticks(5)\n      .tickSize(8)\n\n    let _xAxis = (g) => {\n      g.call(xAxis)\n      g.select(\".domain\").remove()\n      g.selectAll(\".tick line\").attr(\"class\", \"dashed\")\n      g.selectAll(\".tick text\").attr(\"y\", 6)\n    }\n    let _yAxis = (g) => {\n      g.call(yAxis)\n      g.select(\".domain\").remove()\n      g.select(\".tick:first-of-type\").remove()\n      g.selectAll(\".tick text\").attr(\"text-anchor\", \"start\").attr(\"x\", 6)\n    }\n\n    // custom X-Axis\n    svg.append(\"g\")\n      .attr(\"transform\", `translate(0,${height})`)\n      .call(_xAxis);\n\n    // custom Y-Axis\n    svg.append(\"g\")\n      .call(_yAxis)\n\n    // last circle (current value)\n    let g = svg.append(\"g\")\n      .data([data])\n      .attr(\"transform\", (d) => `translate(${x(d[d.length - 1].key)},${y(d[d.length - 1].value)})`)\n\n    g.append(\"circle\")\n      .attr(\"class\", \"circle\")\n      .attr(\"r\", 8)\n\n    g.append(\"text\")\n      .attr(\"class\", \"sum\")\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"dx\", -8 * 2)\n      .text((d) => d[d.length - 1].value.toLocaleString())\n\n  } else {\n    // add the title group\n    let g = svg.append(\"g\")\n      .attr(\"text-anchor\", \"start\")\n      .attr(\"transform\", `translate(${titlePadding},${titlePadding})`)\n\n    let titleLines = 0\n\n    if (title.length) {\n      g.append(\"text\")\n        .attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"class\", \"title\")\n        .text(title)\n        .call(function(fulltext, wrapwidth, start = 0) {\n          fulltext.each(function() {\n            let text = select(this)\n            let word = \"\"\n            let words = text.text().split(/\\s+/).reverse()\n            let _line = []\n            let lineNumber = 0\n            let lineHeight = 1.1\n            let _x = text.attr(\"x\")\n            let _y = text.attr(\"y\")\n            let dy = 0\n            let tspan = text.text(null)\n              .append(\"tspan\")\n              .attr(\"x\", _x)\n              .attr(\"y\", _y)\n              .attr(\"dy\", `${dy}em`)\n\n            /* eslint-disable no-cond-assign, no-plusplus */\n            while (word = words.pop()) {\n              _line.push(word);\n              tspan.text(_line.join(\" \"));\n              if (tspan.node().getComputedTextLength() > wrapwidth) {\n                _line.pop()\n                tspan.text(_line.join(\" \"))\n                _line = [word]\n                tspan = text.append(\"tspan\")\n                  .attr(\"x\", _x)\n                  .attr(\"y\", _y)\n                  .attr(\"dy\", `${(++lineNumber * lineHeight) + dy}em`)\n                  .text(word);\n              }\n            }\n\n            titleLines = lineNumber * lineHeight\n          });\n        }, width - (titlePadding * 2))\n    }\n\n    let fontSize = parseFloat(getComputedStyle(g.node()).fontSize);\n\n    g.append(\"text\")\n      .attr(\"x\", 0)\n      .attr(\"dy\", title.length ? (titlePadding * 2) + (titleLines * fontSize) : (titlePadding * 1.25))\n      .attr(\"class\", \"sum\")\n      .text(data[data.length - 1].value.toLocaleString())\n  }\n}\n"]},"metadata":{},"sourceType":"module"}